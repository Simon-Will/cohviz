var app=app||{};app.urls=function(){this.url=window.location.href;this.url.split("/");return this.url=window.location.href,this.split=this.url.split("/"),this.website=this.split[0]+"//"+this.split[2],this.dashboard=this.website+"/dashboard/",this.experiments=this.website+"/apis/experiments/",this.measurement=this.website+"/apis/measurements/",this.experiment=this.website+"/apis/experiment/",this.user_specific=this.website+"/apis/user-specific/",this.user_experiment=this.website+"/apis/user-experiment/",this.user_specific_name=this.website+"/apis/user-specific-name/",this.user=this.website+"/apis/user-experiment/",this.registration=this.website+"/apis/registration/",this.groups=this.website+"/apis/groups/",this.textanalyzer=this.website+"/apis/textanalyzer/",this.textdata=this.website+"/apis/textdata/",this.csv_text_data=this.website+"/csv_text_export/",this.single_experiment=this.website+"/experiment/",this.run_experiment=this.website+"/run-experiment/",this}(),app.constants=function(){return this.editor_textinput=["<p>Der Editor zur Analyse der Kohärenz von Texten.</p>","<p>Schreibe hier deinen Text, klicke auf <em>Analyziere Text</em> und lass dir anzeigen, wie kohärent dein Text ist.</p>"],this.toast_textinput=["Dein Text konnte nicht verarbeitet werden!                              Schaue, ob du mindestens zwei Sätze geschrieben hast."],this.simpleRevisionModal="Sie haben nun die Gelegenheit Ihren Text zu überarbeiten.                                 Versuchen Sie potentielle Kohärenzbrüche in Ihrem Text zu                                 schließen und Bezüge zwischen den Konzepten klar darzustellen.                                 Integrieren Sie in Ihrer Überarbeitung auch Konzepte und Verbindungen                                 zwischen Konzepten, die Sie eventuell in Ihrem Entwurf noch nicht                                 bedacht haben.",this}(),app.getExperimentId=function(){var e=window.location.href,t=e.substr(e.lastIndexOf("/")+1);return t},app.regExText=function(e){var t=$("#editor-textinput").html();t=t.replace(/[Cc]ognitive [Ll]oad [Tt]heor(y|(ie))/g,"Cognitive-Load-Theory"),t=t.replace(/[Ee]xtrinsischer? [Bb]elastung/g,"Extrinsische-Belastung"),t=t.replace(/[Ii]ntrinsischer? [Bb]elastung/g,"Intrinsische-Belastung"),t=t.replace(/[Ll]ernbezogener? [Bb]elastung/g,"Lernbezogene-Belastung"),t=t.replace(/[Ee]xtrinsic [Ll]oad/,"Extrinsic-Load"),t=t.replace(/[Ii]ntrinsic [Ll]oad/g,"Intrinsic-Load"),t=t.replace(/[Gg]ermane [Ll]oad/g,"Germane-Load"),t=t.replace(/bzw.?/g,"beziehungsweise"),$(e).html(t)},app.getParagraphs=function(e){var t=e.find("p"),n="";return t.each(function(e){n+=t[e].innerText+" "}),n.replace(/(\r\n|\n|\r)/gm,""),n.replace(/\s\s+/g,""),n},app.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},app.replaceAll=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},app.getCookie=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var r=jQuery.trim(n[i]);if(r.substring(0,e.length+1)==e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t},app.csrfSafeMethod=function(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)},app.sameOrigin=function(e){var t=document.location.host,n=document.location.protocol,i="//"+t,r=n+i;return e==r||e.slice(0,r.length+1)==r+"/"||e==i||e.slice(0,i.length+1)==i+"/"||!/^(\/\/|http:|https:).*/.test(e)},app.highlightWholeText=function(e,t,n){$(e).find("p").each(function(e){var i=$(this).text();$(this).html(app.colorText(i,this,t,n))})},app.colorText=function(e,t,n,i){for(var r=e,a=(e.replace(/[.,\/#!$%\^&\*;:{}=_`~()]/g,"").split(" "),r.replace(/[^\wöäüÄÖÜß-\s]|_/g,function(e){return" "+e+" "}).replace(/[ ]+/g," ").split(" ")),s=0;s<a.length;s++)for(var o=a[s],l=0;l<n.length;l++)-1!=$.inArray(o,n[l])&&(a[s]=o.replace(o,'<a style="background-color: '+i(l)+';color: #fff;border-radius: 3px; padding: 1px 3px;" class="cluster'+l+'">'+o+"</a>"));return a.join(" ")},app.highlightSelectedWord=function(e,t,n,i,r,a){for(var s=[],o=0;o<n.length;o++)for(var l=i[n[o]],p=0;p<l.length;p++)s.push(l[p]);n=s,$(e).find("p").each(function(e){for(var s=$(this).text(),o=null,l=0;l<r.length;l++)-1!=r[l].indexOf(t)&&(o=l);for(var p=s,c=(s.replace(/[.,\/#!$%\^&\*;:{}=_`~()]/g,"").split(" "),p.replace(/[^\wöäüÄÖÜß-\s]|_/g,function(e){return" "+e+" "}).replace(/[ ]+/g," ").split(" ")),u=[],d=0;d<c.length;d++){var h=c[d];if(-1!=$.inArray(h,r[o])){for(var m=0;m<i[t].length;m++){var f=i[t][m];h===f&&(u.push(f),c[d]=h.replace(h,'<a style="background-color: '+a(o)+';color: #fff;font-weight:bold; font-size: 1.3em; border-radius: 3px; padding: 1px 3px;" class="cluster'+o+'">'+h+"</a>"))}for(var g=0;g<n.length;g++){var x=n[g];h===x&&(u.push(x),c[d]=h.replace(h,'<a style="background-color: '+a(o)+';color: #fff; opacity: 0.7; border-radius: 3px; padding: 1px 3px;" class="cluster'+o+'">'+h+"</a>"))}}}$(this).html(c.join(" "))})},app.getLinksNodes=function(e){var t=[],n=[],i=[],r=[];e.forEach(function(e){t.push(e[0]),t.push(e[1])}),$.each(t,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),$.each(n,function(e){i.push({index:e,id:n[e]})}),$.each(e,function(t){r.push({source:e[t][0],target:e[t][1]})});var a={nodes:i,links:r};return a};var app=app||{};app.TextAnalyzerModel=Backbone.Model.extend({url:app.urls.textanalyzer});var app=app||{};app.ExperimentModel=Backbone.Model.extend({defaults:{name:"",nr_measurements:"",nr_groups:""},url:app.urls.experiment+app.getExperimentId()});var app=app||{};app.UserModel=Backbone.Model.extend({url:app.urls.user_experiment+app.getExperimentId()});var app=app||{};app.UserSpecificModel=Backbone.Model.extend({url:app.urls.user_specific+app.getExperimentId()});var app=app||{};app.GroupsModel=Backbone.Model.extend({url:app.urls.groups});var app=app||{};app.MeasurementModel=Backbone.Model.extend({url:app.urls.measurement});var app=app||{};app.ExperimentsModel=Backbone.Model.extend({url:app.urls.experiments});var app=app||{};app.TextModelComplete=Backbone.Model.extend({url:app.urls.textdata+app.getExperimentId(),defaults:{pre_text:null,post_text:null,pre_num_sentences:null,post_num_sentences:null,pre_num_clusters:null,post_num_clusters:null,pre_num_coherent_sentences:null,post_num_coherent_sentences:null,pre_num_non_coherent_sentences:null,post_num_non_coherent_sentences:null,pre_page_duration:null,post_page_duration:null,pre_num_concepts:null,post_num_concepts:null}});var app=app||{};app.ExperimentsCollection=Backbone.Collection.extend({url:app.urls.experiments});var app=app||{};app.UserCollection=Backbone.Model.extend({url:app.urls.user_experiment+"/"+app.getExperimentId()});var app=app||{};app.MeasurementCollection=Backbone.Collection.extend({model:app.MeasurementModel});var app=app||{};app.LandingView=Backbone.View.extend({el:$("#landingview"),events:{"click #editor-button":"analyzeText","click #editor-full-button":"reanalyzeText"},initialize:function(){this.colors=d3.scaleOrdinal(d3.schemeCategory10),this.$el.find("#landingview-editor").html(Handlebars.templates.editor({instruction:""}));var e=new MediumEditor("#editor-textinput",{toolbar:!1,placeholder:!1});if(null===localStorage.getItem("firstVisit"))$("#editor-textinput").typed({strings:app.constants.editor_textinput,typeSpeed:2,contentType:"html",cursorChar:"",callback:function(){var t=document.querySelector("#editor-textinput").firstChild;e.selectElement(t)}});else{$("#editor-textinput").html("<p>Schreibe hier ...</p>");var t=document.querySelector("#editor-textinput").firstChild;e.selectElement(t)}this.analyzer=new app.TextAnalyzerModel},analyzeText:function(){var e=this,t=app.getParagraphs(this.$el.find("#editor-textinput"));this.$el.find("#editor-button-div").html(Handlebars.templates["loading-ring"]()),this.analyzer.set({text:t}),this.analyzer.save(null,{success:function(t){e.renderGraph("#editor-textinput",!0,"#editor-full-medium-editor","#editor-full-graph",e.colors)},error:function(t,n){console.log(n.responseText),Materialize.toast(app.constants.toast_textinput,4e3),e.$el.find("#editor-button-div").html(Handlebars.templates.text_analyze_button())}})},reanalyzeText:function(){var e=this,t=app.getParagraphs(this.$el.find("#editor-full-medium-editor"));this.$el.find("#editor-full-button-div").html(Handlebars.templates["loading-ring"]()),this.analyzer.set({text:t}),this.analyzer.save(null,{success:function(t){e.renderGraph("#editor-full-medium-editor",!1,"#editor-full-medium-editor","#editor-full-graph",e.colors),e.$el.find("#editor-full-button-div").html(Handlebars.templates.text_analyze_button_full())},error:function(t,n){Materialize.toast(app.constants.toast_textinput,4e3),e.$el.find("#editor-full-button-div").html(Handlebars.templates.text_analyze_button_full())}})},renderGraph:function(e,t,n,i){var r=this.$el.find(e).html();this.clusters=this.analyzer.get("clusters"),t&&this.$el.find("#landingview-editor").html(Handlebars.templates["editor-full"]({text:r}));var a=(new MediumEditor(n,{toolbar:!1}),$(i).width()),s=$(n).height();$(i).empty(),this.renderCmap(this.analyzer.get("word_pairs"),this.analyzer.get("clusters"),this.analyzer.get("numClusters"),i,s,a,this.colors),null===localStorage.getItem("firstVisit")&&(this.$el.append(Handlebars.templates.modal_instruction()),$("#modal-instruction").openModal(),localStorage.setItem("firstVisit",!1))},renderCmap:function(e,t,n,i,r,a,s){function o(){E.attr("transform",d3.event.transform)}function l(){T.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),C.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}function p(e){d3.event.active||k.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function c(e){e.fx=d3.event.x,e.fy=d3.event.y}function u(e){d3.event.active||k.alphaTarget(0),e.fx=null,e.fy=null}function d(){$("#editor-full-medium-editor").find("p").each(function(e){var t=$(this).text();$(this).html(t)});var e=d3.selectAll(".node");e.selectAll("circle").style("opacity",.6).attr("r",15),e.selectAll("text").style("opacity",0),d3.selectAll(".links").selectAll("line").style("stroke","#ccc")}function h(){var e=d3.mouse(this),t=k.find(e[0],e[1]),n=d3.selectAll(".node").filter(function(e){return e.id==t.id}),i=n.select("text").style("opacity",1).style("font-size",20).style("font-weight","bold");n.select("circle").attr("r",25),C.selectAll("circle").style("opacity",function(e){return m(t,e)?1:.6}),C.selectAll("text").style("opacity",function(e){return m(t,e)?1:0}),T.style("stroke",function(e){return e.source.id===t.id||e.target.id===t.id?"#000":"#ccc"});var r=d3.selectAll(".node").filter(function(e){return e.id!=t.id});r.select("text").style("font-size",16).style("font-weight","normal"),r.select("circle").attr("r",15);var a=i.text(),s=[];C.selectAll("text").each(function(e){m(t,e)&&s.push(e.id)});var o=s.indexOf(a);s.splice(o,1),app.highlightSelectedWord("#editor-full-medium-editor",a,s,w,b,x.colors)}function m(e,t){return g(e,t)||f(e,t)||e.index==t.index}function f(e,t){return S[e.index+","+t.index]}function g(e,t){return S[t.index+","+e.index]}var x=this,b=t,w=this.analyzer.get("lemmaDic"),v=app.getLinksNodes(e),y=r,_=a,z=($(window).height(),{top:0,right:0,bottom:0,left:0}),M=d3.select(i).append("svg").attr("width",_+z.left+z.right).attr("height",y+z.top+z.bottom),k=(M.append("rect").attr("width",_).attr("height",y).style("fill","none").style("pointer-events","all"),d3.forceSimulation().force("link",d3.forceLink().id(function(e){return e.id})).force("charge",d3.forceManyBody().strength(50)).force("center",d3.forceCenter(_/2,y/2)).force("collide",d3.forceCollide(40).iterations(60)));M.call(d3.zoom().scaleExtent([.1,10]).on("zoom",o));var E=M.append("g").on("mouseover",h).on("mouseout",d),T=E.append("g").attr("class","links").selectAll("line").data(v.links).enter().append("line"),C=E.append("g").attr("class","nodes").selectAll(".node").data(v.nodes).enter().append("g").attr("class","node").call(d3.drag().on("start",p).on("drag",c).on("end",u));C.append("circle").attr("r",15).attr("cx",0).attr("cy",0).style("fill",function(e){for(var t=0;t<b.length;t++)if(-1!=$.inArray(e.id,b[t]))return s(t)}).style("opacity",.6),C.append("text").attr("dy","-.35em").attr("dx","1.4em").text(function(e){return e.id});k.nodes(v.nodes).on("tick",l),k.force("link").links(v.links);var S={};T.each(function(e){S[e.source.index+","+e.target.index]=!0})}}),"/"==window.location.pathname&&new app.LandingView;var app=app||{};app.LoginView=Backbone.View.extend({initialize:function(){console.log("login")}}),"/login/"==window.location.pathname&&new app.LoginView;var app=app||{};app.DashboardView=Backbone.View.extend({el:$("#dashboard"),events:{"click .table-row":"redirect"},initialize:function(){var e=this;this.experiments=new app.ExperimentsCollection,this.experiments.fetch({success:function(){e.renderExperiments()}})},renderExperiments:function(){this.$el.find("#experiments").html(Handlebars.templates.experiments({experiment:this.experiments.toJSON()})),this.$el.on(".table-row",this.redirect,this)},redirect:function(e){var t=$(e.currentTarget).attr("id");window.location=app.urls.single_experiment+t}}),"/dashboard/"==window.location.pathname&&new app.DashboardView;var app=app||{};app.ExperimentView=Backbone.View.extend({el:$("#experiment-single"),events:{"click #new-user-button":"generateUser","click #data-export-button":"dataExport"},initialize:function(){this.experiment_id=app.getExperimentId(),this.singleExperimentModel=new app.ExperimentModel,this.UserCollection=new app.UserCollection,this.UserModel=new app.UserModel;var e=this;this.singleExperimentModel.fetch({success:function(t){e.renderHeader()},error:function(){Materialize.toast("Das Experiment konnte nicht gefunden werden!",4e3)}}),this.fetchUsers()},fetchUsers:function(){var e=this;this.UserCollection.fetch({success:function(t){e.renderUsers()},error:function(){Materialize.toast("Die Nutzerdaten konnten nicht gefunden werden!",4e3)}})},renderHeader:function(){this.$("h1").first().html(this.singleExperimentModel.get("name")),this.$("#experiment-header").attr("href",app.urls.run_experiment+this.singleExperimentModel.get("master_pw"))},renderUsers:function(){this.$el.find("#users").html(Handlebars.templates.users({user:this.UserCollection.toJSON()}))},generateUser:function(){var e=this;this.UserModel.set({nr_users:1}),this.UserModel.save(null,{success:function(t,n){e.fetchUsers()},error:function(e,t){console.log(t.responseText)}})},dataExport:function(){console.log("export data"),window.open(app.urls.csv_text_data+app.getExperimentId())}}),window.location.pathname.startsWith("/experiment/")&&new app.ExperimentView,app.NewExperimentView=Backbone.View.extend({el:$("#new-experiment"),events:{"click #add-measurement":"addMeasurement","click #save-experiment":"saveExperiment"},initialize:function(){var e=this;this.groupsModel=new app.GroupsModel,this.groupsModel.fetch({success:function(t){e.renderForm()},error:function(e){console.log("Die Gruppen konnten nicht geladen werden")}}),this.measurementCollection=new app.MeasurementCollection,this.measurementModel=new app.MeasurementModel,this.experimentModel=new app.ExperimentsModel,this.listenTo(this.measurementModel,"change",this.modelChanged),this.measurements={1:0,2:0,3:0,4:0,5:0}},renderForm:function(){this.$el.find("#experiment-generator").html(Handlebars.templates["experiment-generator"]({group:this.groupsModel.toJSON()})),this.$el.find("select").material_select(),this.$el.find(".datepicker").pickadate({selectMonths:!0,selectYears:15,format:"yyyy-mm-dd"})},modelChanged:function(){this.measurementCollection.add(this.measurementModel.toJSON()),this.renderTable()},renderTable:function(){this.$el.find("#experiment-table").html(Handlebars.templates["measurements-table"]({measurement:this.measurementCollection.toJSON()}))},addMeasurement:function(){var e=this,t=this.$el.find("#form-group").val(),n=this.$el.find("#form-treatment").val(),i=this.$el.find("#form-date").val();this.measurements[t]+=1,""===i?Materialize.toast("Bitte füge noch ein Datum ein",4e3):this.measurementModel.set({experiment:"",publication:i,measure:e.measurements[t],nr_group:Number(t),instruction:"",group:n})},saveExperiment:function(){var e=this,t=this.$el.find("#experiment-name").val().trim();if(""===t)Materialize.toast("Bitte tragen Sie noch den Namen des Experiements ein",4e3);else{var n=new Set,i=new Set;this.measurementCollection.each(function(e){n.add(e.toJSON().nr_group),i.add(e.toJSON().measure)}),0===i.size?Materialize.toast("Bitte fügen Sie noch Messzeitpunkte ein.",4e3):(this.experimentModel.set({name:t,nr_measurements:i.size,nr_groups:n.size}),this.experimentModel.save(null,{success:function(t,n){e.saveMeasurements()},error:function(e,t){console.log(t)}}))}},saveMeasurements:function(){var e=this,t=this.measurementCollection.length;this.measurementCollection.each(function(n){n.url=app.urls.measurement+e.experimentModel.get("master_pw"),n.save(null,{success:function(e,n){t-=1,0==t&&(window.location=app.urls.dashboard)},error:function(e,t){console.log(t.responseText)}})})}}),"/new-experiment/"==window.location.pathname&&new app.NewExperimentView,app.SubjectLoginView=Backbone.View.extend({el:$("#subject-login"),events:{"submit form":"submit"},initialize:function(){},submit:function(){event.preventDefault();var e=this.$el.find("#username").val();tidyUsername=e.replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/Ä/g,"ae").replace(/Ö/g,"oe").replace(/Ü/g,"ue").replace(/ß/g,"ss").toLowerCase();var t=/^([a-z]{2,4}(0[1-9]|1[012])[a-z]{2,4})$/;if(6==e.length&&t.test(tidyUsername)){var n=app.getCookie("csrftoken");$.ajax({beforeSend:function(e,t){!app.csrfSafeMethod(t.type)&&app.sameOrigin(t.url)&&e.setRequestHeader("X-CSRFToken",n)},type:"POST",url:window.location.href,data:{username:tidyUsername},success:function(e){window.location=app.urls.run_experiment+app.getExperimentId()},error:function(e){console.log(e.responseText),Materialize.toast(e.responseText,4e3)}})}else Materialize.toast("Ihr Nutzername entspricht nicht dem Muster.",4e3)}}),window.location.pathname.startsWith("/login-experiment")&&new app.SubjectLoginView;
//# sourceMappingURL=app.js.map
