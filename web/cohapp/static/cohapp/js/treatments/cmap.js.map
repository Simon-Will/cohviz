{"version":3,"sources":["cmap.js"],"names":["app","CmapView","Backbone","View","extend","el","events","click #instruction-read","click #help","click #editor-button","click #editor-full-button","initialize","self","this","prePageDurationStart","postPageDurationStart","colors","d3","scaleOrdinal","schemeCategory10","userModel","UserSpecificModel","textModel","TextModelComplete","analyzer","TextAnalyzerModel","fetch","success","model","response","renderInstruction","error","console","log","$el","html","Handlebars","templates","instruction","get","renderEditor","Date","editor","MediumEditor","toolbar","placeholder","$","editableElement","document","querySelector","firstChild","selectElement","append","renderInstructionModal","openModal","analyzeText","regExText","text","getParagraphs","find","length","Materialize","toast","draftElapsed","set","pre_page_duration","pre_text","save","renderRevision","responseText","pre_num_sentences","pre_num_clusters","pre_num_coherent_sentences","pre_num_non_coherent_sentences","pre_num_concepts","paragraphs","constants","simpleRevisionModal","svgWidth","width","svgHeight","height","renderCmap","pairs","clust","numClusters","svgID","zoomed","g","attr","event","transform","ticked","link","d","source","x","y","target","node","dragstarted","active","simulation","alphaTarget","restart","fx","fy","dragged","dragended","mouseout","each","paragraph","textParagraph","nodes","selectAll","style","mouseover","mouse","obj","nodeSelected","filter","id","select","isConnected","nodeUnselected","a","b","isConnectedAsTarget","isConnectedAsSource","index","linkedByIndex","clusters","graph","getLinksNodes","margin","window","top","right","bottom","left","svg","forceSimulation","force","forceLink","forceManyBody","strength","forceCenter","forceCollide","iterations","call","zoom","scaleExtent","on","data","links","enter","drag","word","i","inArray","saveText","revisionElapsed","post_text","post_page_duration","sendToServer","post_num_sentences","post_num_clusters","post_num_coherent_sentences","post_num_non_coherent_sentences","post_num_concepts","location","reload"],"mappings":"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","file":"cmap.js","sourcesContent":["var app = app || {};\n\n\napp.CmapView = Backbone.View.extend({\n\n    el: '#treatment-cmap',\n\n\tevents: {\n        'click #instruction-read': 'renderEditor',\n\t\t'click #help': 'renderInstructionModal',\n\t\t'click #editor-button': 'analyzeText',\n\t\t'click #editor-full-button': 'saveText',\n\t},\n\n\tinitialize: function() {\n        // Variable declaration\n        var self = this;\n        this.prePageDurationStart = null;\n        this.postPageDurationStart = null;\n\n\t\t// Generate 20 distinct colors for the cmap\n\t\tthis.colors = d3.scaleOrdinal(d3.schemeCategory10);\n        \n        // Get user data\n        this.userModel = new app.UserSpecificModel();\n\n        // Init textanalyzer model\n        this.textModel = new app.TextModelComplete();\n\n        // Init textAnalyzer model\n        this.analyzer = new app.TextAnalyzerModel();\n\n        // Fetch user data\n        this.userModel.fetch({\n            success: function(model, response) {\n                self.renderInstruction();\n            },\n            error: function(model, response) {\n                console.log(response);\n            }\n        });\n\n\t},\n\n    /** Render instruction for \n      * this part of the experiment\n      */\n\trenderInstruction: function() {\n        // Render instruction\n        this.$el.html(\n            Handlebars.templates.instruction({'instruction':\n                this.userModel.get('instruction')}));\n\t},\n\n\t/** \n     * When user has read the instruction he or she is able\n     * to write their text.\n     */\n    renderEditor: function() {\n        // Start timer for draft\n        this.prePageDurationStart = new Date();\n\n        // Render editor\n        this.$el.html(Handlebars.templates.editor());\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-textinput', {\n            toolbar: false,\n            placeholder: false,\n        });\n\n        // Add text to editor\n        $('#editor-textinput').html('<p>Schreibe hier ...</p>');\n\n        // Select text so that user can type instantly\n        var editableElement = document.\n            querySelector('#editor-textinput').firstChild;\n        editor.selectElement(editableElement);\n\n        // Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal \n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instruction') }));\n    },\n\n    /**\n     * Render modal of instruction\n     */\n    renderInstructionModal: function() {\n        $('#modal-help').openModal();\n    },\n\n    /**\n     * After user has written his or her text the \n     * user gets feedback on the draft. \n     * Before users can see the feedback we need \n     * to make some sanity checks whether the \n     * text is long enough.\n     */\n    analyzeText: function() {\n        var self = this;\n\n        // Change text with major concepts\n        app.regExText('#editor-textinput');\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-textinput'));\n\n        // Check if text is long enough\n        if (text.length < 1000) {\n            // Display toast\n            Materialize.toast('Ihr Text ist leider zu kurz.', 4000);\n        } else {\n            // Stop timer for draft\n            var draftElapsed = (new Date() - this.prePageDurationStart) / 1000;\n\n            // Start timer for text revision\n            this.postPageDurationStart = new Date();\n\n            // Set draft time and draftText to textModel\n            this.textModel.set({'pre_page_duration': draftElapsed,\n                                'pre_text': text});\n\n            // Render loading ring\n            this.$el.find('#editor-button-div').html(\n                Handlebars.templates['loading-ring']());\n\n            // Get text data\n            this.analyzer.set({'text': text});\n            this.analyzer.save(null, {\n                success: function(response) {\n                    self.renderRevision();\n                },\n                error: function(model, response) {\n                    console.log(response.responseText);\n                }\n            });\n        }\n    },\n\n\n    /**\n     * After user has written the draft she gets the \n     * opportunity to revise her text\n     */\n    renderRevision: function() {\n\t\tvar self = this;\n\n        // Render submit button\n        this.$el.find('#editor-button-div').html(\n                '<a class=\"waves-effect waves-light btn\" id=\"save-text\">Text abschicken</a>');\n\n        // Save data for draft\n        this.textModel.set({'pre_text': this.analyzer.get('text'),\n            'pre_num_sentences': this.analyzer.get('numSentences'),\n            'pre_num_clusters': this.analyzer.get('numClusters'),\n            'pre_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'pre_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'pre_num_concepts': this.analyzer.get('numConcepts')});\n\n\t\t// Get inner html of text input\n\t\tthis.paragraphs = $('#editor-textinput').html();\n\n        // Change inner html\n        this.$el.html(Handlebars.templates['editor-full']({'instruction':\n            app.constants.simpleRevisionModal}));\n\n        // Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal \n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instructionreview') }));\n\n        // Change inner html of editor\n        $('#editor-full-medium-editor').html(this.paragraphs);\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-full-medium-editor', {\n\t\t\ttoolbar: false,\n\t\t});\n\n        // Change text of Button\n        $('#editor-full-button').text('Text abschicken');\n\n\t\t// Display modal\n        this.$el.append(Handlebars.templates['modal-revision']({'instruction':\n            this.userModel.get('instructionreview')}));\n        $('#modal-revision').openModal();\n\n        // Set width of height of svg element\n        var svgWidth = $('#editor-full-graph').width();\n\t\tvar svgHeight = $('#editor-full-medium-editor').height();\n\n\t\t// Render graph\n\t\tthis.renderCmap(this.analyzer.get('word_pairs'),\n\t\t\tthis.analyzer.get('clusters'), this.analyzer.get('numClusters'),\n\t\t\t'#editor-full-graph', svgHeight, svgWidth, this.colors);\n    },\n\n\n\trenderCmap: function(pairs, clust, numClusters, svgID, height, width, colors)  {\n        var self = this;\n    \n        // ****************** Render SVG ***************************************\n        // Variable declaration\n        var clusters = clust;\n        var lemmaDic = this.analyzer.get('lemmaDic');\n        var graph = app.getLinksNodes(pairs);\n\n        // // Adjust height of svg\n        var svgHeight = height;\n        var svgWidth = width;\n        var windowHeight = $(window).height();\n\n        // Set margin and width\n        var margin = {top: 0, right: 0, bottom: 0, left: 0};\n\n        // Select svg\n        var svg = d3.select(svgID).append(\"svg\")\n            .attr(\"width\", svgWidth + margin.left + margin.right)\n            .attr(\"height\", svgHeight + margin.top + margin.bottom);\n\n        // Append rectangle to svg\n        var rect = svg.append(\"rect\")\n            .attr(\"width\", svgWidth)\n            .attr(\"height\", svgHeight)\n            .style(\"fill\", \"none\")\n            .style(\"pointer-events\", \"all\");\n\n        // Create new force simulation\n        var simulation = d3.forceSimulation()\n            .force('link', d3.forceLink().id(function(d) {\n                return d.id;\n            }))\n            .force('charge', d3.forceManyBody().strength(50))\n            .force('center', d3.forceCenter(svgWidth / 2, svgHeight / 2))\n            .force('collide', d3.forceCollide(40).iterations(60));\n\n        ///////////////////////////////\n        // Enable zoom functionality //\n        ///////////////////////////////\n        \n        // Call zoom\n        svg.call(d3.zoom()\n            .scaleExtent([1 / 10, 10])\n            .on('zoom', zoomed));\n\n        // Wrap everything in g element\n        var g = svg.append('g')\n            .on('mouseover', mouseover)\n            .on('mouseout', mouseout);\n\n        /**\n         * Zoom function\n         */\n        function zoomed() {\n            g.attr('transform', d3.event.transform);\n        }\n        \n        // Add links\n        var link = g.append('g')\n            .attr('class', 'links')\n            .selectAll('line')\n            .data(graph.links)\n            .enter().append('line');\n\n        // Create g element that stores\n        // circles and text and call dragging on it\n        var node = g.append('g')\n            .attr('class', 'nodes')\n            .selectAll('.node')\n            .data(graph.nodes)\n            .enter().append('g')\n            .attr('class', 'node')\n            .call(d3.drag()\n                .on('start', dragstarted)\n                .on('drag', dragged)\n                .on('end', dragended));\n        \n        // Append cirles to node\n        var circles = node.append('circle')\n            // .attr('class', 'nodes')\n            .attr('r', 15)\n            .attr('cx', 0)\n            .attr('cy', 0)\n            // .attr('ry', 2)\n            .style(\"fill\", function (word) {\n                // Loop over every cluster\n                for (var i = 0; i < clusters.length; i++) {\n                    // Check if current word is in current Array\n                    if ($.inArray(word.id, clusters[i]) != -1) {\n                        // Return color if word war found in array\n                        return colors(i);\n                    }\n                }\n            })\n            .style('opacity', 0.6);\n\n        // Append label to node container\n        var label = node.append('text')\n            .attr('dy', '-.35em')\n            .attr('dx', '1.4em')\n            .text(function(d) {\n                return d.id;\n            });\n\n        // Add nodes to simulation\n        simulation\n            .nodes(graph.nodes)\n            .on('tick', ticked);\n\n        // Add links to simulation\n        simulation.force('link')\n            .links(graph.links);\n\n        var linkedByIndex = {};\n            link.each(function(d) {\n                linkedByIndex[d.source.index + \",\" + d.target.index] = true;\n            });\n\n        /**\n         * Tick function adds x and y\n         * coordinates to nodes and links\n         */\n        function ticked() {\n            // Update links\n            link\n                .attr('x1', function(d) { return d.source.x; })\n                .attr('y1', function(d) { return d.source.y; })\n                .attr('x2', function(d) { return d.target.x; })\n                .attr('y2', function(d) { return d.target.y; });\n\n            // Update nodes\n            node.attr('transform', function(d) {\n                return 'translate(' + d.x + ',' + d.y + ')';\n            });\n        }\n\n        function dragstarted(d) {\n            if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n            d.fx = d.x;\n            d.fy = d.y;\n        }\n\n        function dragged(d) {\n            d.fx = d3.event.x;\n            d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n            if (!d3.event.active) simulation.alphaTarget(0);\n            d.fx = null;\n            d.fy = null;\n        }\n\n        function mouseout() {\n            $('#editor-full-medium-editor').find('p').each(function(paragraph) {\n                var textParagraph = $(this).text();\n                // console.log(textParagraph);\n\n                $(this).html(textParagraph);\n            });\n\n            // Get all nodes\n            var nodes = d3.selectAll('.node');\n\n            nodes.selectAll('circle')\n                .style('opacity', 0.6)\n                .attr('r', 15);\n\n            nodes.selectAll('text')\n                .style('opacity', 0);\n\n            d3.selectAll('.links').selectAll('line')\n                .style('stroke', '#ccc');\n\n        }\n\n        function mouseover() {\n            // Get data\n            var mouse = d3.mouse(this);\n            var obj = simulation.find(mouse[0], mouse[1]);\n            \n            //////////////////////\n            // Selected element //\n            //////////////////////\n            var nodeSelected = d3.selectAll('.node')\n                .filter(function(d) {\n                    return d.id == obj.id;\n                });\n\n            var textSelected = nodeSelected.select('text')\n                .style('opacity', 1)\n                .style('font-size', 20)\n                .style('font-weight', 'bold');\n\n            nodeSelected.select('circle')\n                .attr('r', 25);\n\n            //////////////////////////////\n            // Highlight adjacent nodes //\n            //////////////////////////////\n            node.selectAll('circle')\n                // .transition()\n                // .duration(20)\n                .style('opacity', function(d) {\n\n                    if (isConnected(obj, d)) {\n                        return 1;\n                    }\n\n                    return 0.6;\n                });\n\n            node.selectAll('text')\n                // .transition()\n                // .duration(20)\n                .style('opacity', function(d) {\n\n                    if (isConnected(obj, d)) {\n                        return 1;\n                    }\n\n                    return 0;\n\n                });\n\n            /////////////////////\n            // Highlight links //\n            /////////////////////\n            link\n                // .transition()\n                // .duration(20)\n                .style('stroke', function(d) {\n                    return d.source.id === obj.id || d.target.id === obj.id ? '#000' : '#ccc';\n                });\n\n\n            ////////////////////////\n            // Unselected element //\n            ////////////////////////\n            var nodeUnselected = d3.selectAll('.node')\n                .filter(function(d) {\n                    return d.id != obj.id;\n                });\n\n            nodeUnselected.select('text')\n                .style('font-size', 16)\n                .style('font-weight', 'normal');\n\n            nodeUnselected.select('circle')\n                .attr('r', 15);\n        }\n\n        function isConnected(a, b) {\n            return isConnectedAsTarget(a, b) || isConnectedAsSource(a, b) || a.index == b.index;\n        }\n\n        function isConnectedAsSource(a, b) {\n            return linkedByIndex[a.index + \",\" + b.index];\n        }\n\n        function isConnectedAsTarget(a, b) {\n            return linkedByIndex[b.index + \",\" + a.index];\n        }\n    },\n\n    saveText: function() {\n        var self = this;\n\n        // Get seconds subject worked for revision\n        var revisionElapsed = (new Date() - this.postPageDurationStart) / 1000;\n\n        // Render loading ring\n        this.$el.find('#editor-full-button-div').html(\n            Handlebars.templates['loading-ring']());\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-full-medium-editor'));\n\n        // Save post text to textModel\n        this.textModel.set({'post_text': text,\n                            'post_page_duration': revisionElapsed});\n\n        // Set text to analyzer\n        this.analyzer.set({'text': text});\n\n        // Fetch data\n        this.analyzer.save(null, {\n            success: function(response) {\n                self.sendToServer();\n            },\n            error: function(model, response) {\n                console.log(response.responseText);\n            }\n        });\n    },\n\n    sendToServer: function() {\n        // Save last data \n        this.textModel.set({'post_num_sentences': this.analyzer.get('numSentences'),\n            'post_num_clusters': this.analyzer.get('numClusters'),\n            'post_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'post_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'post_num_concepts': this.analyzer.get('numConcepts')});\n        \n        // Send data to server\n        this.textModel.save(null, {\n            success: function(response) {\n                // Reload page\n                location.reload();\n            },\n            error: function(model, response) {\n                console.log('error');\n            }\n        });\n    }\n\n\n});\n\nnew app.CmapView();\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJjbWFwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhcHAgfHwge307XG5cblxuYXBwLkNtYXBWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXG4gICAgZWw6ICcjdHJlYXRtZW50LWNtYXAnLFxuXG5cdGV2ZW50czoge1xuICAgICAgICAnY2xpY2sgI2luc3RydWN0aW9uLXJlYWQnOiAncmVuZGVyRWRpdG9yJyxcblx0XHQnY2xpY2sgI2hlbHAnOiAncmVuZGVySW5zdHJ1Y3Rpb25Nb2RhbCcsXG5cdFx0J2NsaWNrICNlZGl0b3ItYnV0dG9uJzogJ2FuYWx5emVUZXh0Jyxcblx0XHQnY2xpY2sgI2VkaXRvci1mdWxsLWJ1dHRvbic6ICdzYXZlVGV4dCcsXG5cdH0sXG5cblx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFZhcmlhYmxlIGRlY2xhcmF0aW9uXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5wcmVQYWdlRHVyYXRpb25TdGFydCA9IG51bGw7XG4gICAgICAgIHRoaXMucG9zdFBhZ2VEdXJhdGlvblN0YXJ0ID0gbnVsbDtcblxuXHRcdC8vIEdlbmVyYXRlIDIwIGRpc3RpbmN0IGNvbG9ycyBmb3IgdGhlIGNtYXBcblx0XHR0aGlzLmNvbG9ycyA9IGQzLnNjYWxlT3JkaW5hbChkMy5zY2hlbWVDYXRlZ29yeTEwKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCB1c2VyIGRhdGFcbiAgICAgICAgdGhpcy51c2VyTW9kZWwgPSBuZXcgYXBwLlVzZXJTcGVjaWZpY01vZGVsKCk7XG5cbiAgICAgICAgLy8gSW5pdCB0ZXh0YW5hbHl6ZXIgbW9kZWxcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwgPSBuZXcgYXBwLlRleHRNb2RlbENvbXBsZXRlKCk7XG5cbiAgICAgICAgLy8gSW5pdCB0ZXh0QW5hbHl6ZXIgbW9kZWxcbiAgICAgICAgdGhpcy5hbmFseXplciA9IG5ldyBhcHAuVGV4dEFuYWx5emVyTW9kZWwoKTtcblxuICAgICAgICAvLyBGZXRjaCB1c2VyIGRhdGFcbiAgICAgICAgdGhpcy51c2VyTW9kZWwuZmV0Y2goe1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXJJbnN0cnVjdGlvbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cdH0sXG5cbiAgICAvKiogUmVuZGVyIGluc3RydWN0aW9uIGZvciBcbiAgICAgICogdGhpcyBwYXJ0IG9mIHRoZSBleHBlcmltZW50XG4gICAgICAqL1xuXHRyZW5kZXJJbnN0cnVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFJlbmRlciBpbnN0cnVjdGlvblxuICAgICAgICB0aGlzLiRlbC5odG1sKFxuICAgICAgICAgICAgSGFuZGxlYmFycy50ZW1wbGF0ZXMuaW5zdHJ1Y3Rpb24oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICAgICAgdGhpcy51c2VyTW9kZWwuZ2V0KCdpbnN0cnVjdGlvbicpfSkpO1xuXHR9LFxuXG5cdC8qKiBcbiAgICAgKiBXaGVuIHVzZXIgaGFzIHJlYWQgdGhlIGluc3RydWN0aW9uIGhlIG9yIHNoZSBpcyBhYmxlXG4gICAgICogdG8gd3JpdGUgdGhlaXIgdGV4dC5cbiAgICAgKi9cbiAgICByZW5kZXJFZGl0b3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBTdGFydCB0aW1lciBmb3IgZHJhZnRcbiAgICAgICAgdGhpcy5wcmVQYWdlRHVyYXRpb25TdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gUmVuZGVyIGVkaXRvclxuICAgICAgICB0aGlzLiRlbC5odG1sKEhhbmRsZWJhcnMudGVtcGxhdGVzLmVkaXRvcigpKTtcblxuICAgICAgICAvLyBFbmFibGUgZWRpdG9yIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgdmFyIGVkaXRvciA9IG5ldyBNZWRpdW1FZGl0b3IoJyNlZGl0b3ItdGV4dGlucHV0Jywge1xuICAgICAgICAgICAgdG9vbGJhcjogZmFsc2UsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCB0ZXh0IHRvIGVkaXRvclxuICAgICAgICAkKCcjZWRpdG9yLXRleHRpbnB1dCcpLmh0bWwoJzxwPlNjaHJlaWJlIGhpZXIgLi4uPC9wPicpO1xuXG4gICAgICAgIC8vIFNlbGVjdCB0ZXh0IHNvIHRoYXQgdXNlciBjYW4gdHlwZSBpbnN0YW50bHlcbiAgICAgICAgdmFyIGVkaXRhYmxlRWxlbWVudCA9IGRvY3VtZW50LlxuICAgICAgICAgICAgcXVlcnlTZWxlY3RvcignI2VkaXRvci10ZXh0aW5wdXQnKS5maXJzdENoaWxkO1xuICAgICAgICBlZGl0b3Iuc2VsZWN0RWxlbWVudChlZGl0YWJsZUVsZW1lbnQpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBoZWxwIGJ1dHRvbiB0byB3aW5kb3dcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKCc8aSBpZD1cImhlbHBcIiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+aGVscDwvaT4nKTtcblxuICAgICAgICAvLyBBcHBlbmQgbW9kYWwgXG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZChIYW5kbGViYXJzLnRlbXBsYXRlc1snbW9kYWwtaGVscCddKHsnaW5zdHJ1Y3Rpb24nOlxuICAgICAgICAgICAgdGhpcy51c2VyTW9kZWwuZ2V0KCdpbnN0cnVjdGlvbicpIH0pKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIG1vZGFsIG9mIGluc3RydWN0aW9uXG4gICAgICovXG4gICAgcmVuZGVySW5zdHJ1Y3Rpb25Nb2RhbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJyNtb2RhbC1oZWxwJykub3Blbk1vZGFsKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFmdGVyIHVzZXIgaGFzIHdyaXR0ZW4gaGlzIG9yIGhlciB0ZXh0IHRoZSBcbiAgICAgKiB1c2VyIGdldHMgZmVlZGJhY2sgb24gdGhlIGRyYWZ0LiBcbiAgICAgKiBCZWZvcmUgdXNlcnMgY2FuIHNlZSB0aGUgZmVlZGJhY2sgd2UgbmVlZCBcbiAgICAgKiB0byBtYWtlIHNvbWUgc2FuaXR5IGNoZWNrcyB3aGV0aGVyIHRoZSBcbiAgICAgKiB0ZXh0IGlzIGxvbmcgZW5vdWdoLlxuICAgICAqL1xuICAgIGFuYWx5emVUZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vIENoYW5nZSB0ZXh0IHdpdGggbWFqb3IgY29uY2VwdHNcbiAgICAgICAgYXBwLnJlZ0V4VGV4dCgnI2VkaXRvci10ZXh0aW5wdXQnKTtcblxuICAgICAgICAvLyBHZXQgdGV4dFxuICAgICAgICB2YXIgdGV4dCA9IGFwcC5nZXRQYXJhZ3JhcGhzKHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItdGV4dGlucHV0JykpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRleHQgaXMgbG9uZyBlbm91Z2hcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoIDwgMTAwMCkge1xuICAgICAgICAgICAgLy8gRGlzcGxheSB0b2FzdFxuICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0lociBUZXh0IGlzdCBsZWlkZXIgenUga3Vyei4nLCA0MDAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFN0b3AgdGltZXIgZm9yIGRyYWZ0XG4gICAgICAgICAgICB2YXIgZHJhZnRFbGFwc2VkID0gKG5ldyBEYXRlKCkgLSB0aGlzLnByZVBhZ2VEdXJhdGlvblN0YXJ0KSAvIDEwMDA7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IHRpbWVyIGZvciB0ZXh0IHJldmlzaW9uXG4gICAgICAgICAgICB0aGlzLnBvc3RQYWdlRHVyYXRpb25TdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIC8vIFNldCBkcmFmdCB0aW1lIGFuZCBkcmFmdFRleHQgdG8gdGV4dE1vZGVsXG4gICAgICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwcmVfcGFnZV9kdXJhdGlvbic6IGRyYWZ0RWxhcHNlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ByZV90ZXh0JzogdGV4dH0pO1xuXG4gICAgICAgICAgICAvLyBSZW5kZXIgbG9hZGluZyByaW5nXG4gICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWJ1dHRvbi1kaXYnKS5odG1sKFxuICAgICAgICAgICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzWydsb2FkaW5nLXJpbmcnXSgpKTtcblxuICAgICAgICAgICAgLy8gR2V0IHRleHQgZGF0YVxuICAgICAgICAgICAgdGhpcy5hbmFseXplci5zZXQoeyd0ZXh0JzogdGV4dH0pO1xuICAgICAgICAgICAgdGhpcy5hbmFseXplci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlclJldmlzaW9uKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgKiBBZnRlciB1c2VyIGhhcyB3cml0dGVuIHRoZSBkcmFmdCBzaGUgZ2V0cyB0aGUgXG4gICAgICogb3Bwb3J0dW5pdHkgdG8gcmV2aXNlIGhlciB0ZXh0XG4gICAgICovXG4gICAgcmVuZGVyUmV2aXNpb246IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyBSZW5kZXIgc3VibWl0IGJ1dHRvblxuICAgICAgICB0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWJ1dHRvbi1kaXYnKS5odG1sKFxuICAgICAgICAgICAgICAgICc8YSBjbGFzcz1cIndhdmVzLWVmZmVjdCB3YXZlcy1saWdodCBidG5cIiBpZD1cInNhdmUtdGV4dFwiPlRleHQgYWJzY2hpY2tlbjwvYT4nKTtcblxuICAgICAgICAvLyBTYXZlIGRhdGEgZm9yIGRyYWZ0XG4gICAgICAgIHRoaXMudGV4dE1vZGVsLnNldCh7J3ByZV90ZXh0JzogdGhpcy5hbmFseXplci5nZXQoJ3RleHQnKSxcbiAgICAgICAgICAgICdwcmVfbnVtX3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1TZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwcmVfbnVtX2NsdXN0ZXJzJzogdGhpcy5hbmFseXplci5nZXQoJ251bUNsdXN0ZXJzJyksXG4gICAgICAgICAgICAncHJlX251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncHJlX251bV9ub25fY29oZXJlbnRfc2VudGVuY2VzJzogdGhpcy5hbmFseXplci5nZXQoJ2NvaE5vdFNlbnRlbmNlcycpLFxuICAgICAgICAgICAgJ3ByZV9udW1fY29uY2VwdHMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ29uY2VwdHMnKX0pO1xuXG5cdFx0Ly8gR2V0IGlubmVyIGh0bWwgb2YgdGV4dCBpbnB1dFxuXHRcdHRoaXMucGFyYWdyYXBocyA9ICQoJyNlZGl0b3ItdGV4dGlucHV0JykuaHRtbCgpO1xuXG4gICAgICAgIC8vIENoYW5nZSBpbm5lciBodG1sXG4gICAgICAgIHRoaXMuJGVsLmh0bWwoSGFuZGxlYmFycy50ZW1wbGF0ZXNbJ2VkaXRvci1mdWxsJ10oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICBhcHAuY29uc3RhbnRzLnNpbXBsZVJldmlzaW9uTW9kYWx9KSk7XG5cbiAgICAgICAgLy8gQXBwZW5kIGhlbHAgYnV0dG9uIHRvIHdpbmRvd1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoJzxpIGlkPVwiaGVscFwiIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5oZWxwPC9pPicpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBtb2RhbCBcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKEhhbmRsZWJhcnMudGVtcGxhdGVzWydtb2RhbC1oZWxwJ10oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICB0aGlzLnVzZXJNb2RlbC5nZXQoJ2luc3RydWN0aW9ucmV2aWV3JykgfSkpO1xuXG4gICAgICAgIC8vIENoYW5nZSBpbm5lciBodG1sIG9mIGVkaXRvclxuICAgICAgICAkKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicpLmh0bWwodGhpcy5wYXJhZ3JhcGhzKTtcblxuICAgICAgICAvLyBFbmFibGUgZWRpdG9yIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgdmFyIGVkaXRvciA9IG5ldyBNZWRpdW1FZGl0b3IoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJywge1xuXHRcdFx0dG9vbGJhcjogZmFsc2UsXG5cdFx0fSk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHRleHQgb2YgQnV0dG9uXG4gICAgICAgICQoJyNlZGl0b3ItZnVsbC1idXR0b24nKS50ZXh0KCdUZXh0IGFic2NoaWNrZW4nKTtcblxuXHRcdC8vIERpc3BsYXkgbW9kYWxcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKEhhbmRsZWJhcnMudGVtcGxhdGVzWydtb2RhbC1yZXZpc2lvbiddKHsnaW5zdHJ1Y3Rpb24nOlxuICAgICAgICAgICAgdGhpcy51c2VyTW9kZWwuZ2V0KCdpbnN0cnVjdGlvbnJldmlldycpfSkpO1xuICAgICAgICAkKCcjbW9kYWwtcmV2aXNpb24nKS5vcGVuTW9kYWwoKTtcblxuICAgICAgICAvLyBTZXQgd2lkdGggb2YgaGVpZ2h0IG9mIHN2ZyBlbGVtZW50XG4gICAgICAgIHZhciBzdmdXaWR0aCA9ICQoJyNlZGl0b3ItZnVsbC1ncmFwaCcpLndpZHRoKCk7XG5cdFx0dmFyIHN2Z0hlaWdodCA9ICQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJykuaGVpZ2h0KCk7XG5cblx0XHQvLyBSZW5kZXIgZ3JhcGhcblx0XHR0aGlzLnJlbmRlckNtYXAodGhpcy5hbmFseXplci5nZXQoJ3dvcmRfcGFpcnMnKSxcblx0XHRcdHRoaXMuYW5hbHl6ZXIuZ2V0KCdjbHVzdGVycycpLCB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ2x1c3RlcnMnKSxcblx0XHRcdCcjZWRpdG9yLWZ1bGwtZ3JhcGgnLCBzdmdIZWlnaHQsIHN2Z1dpZHRoLCB0aGlzLmNvbG9ycyk7XG4gICAgfSxcblxuXG5cdHJlbmRlckNtYXA6IGZ1bmN0aW9uKHBhaXJzLCBjbHVzdCwgbnVtQ2x1c3RlcnMsIHN2Z0lELCBoZWlnaHQsIHdpZHRoLCBjb2xvcnMpICB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBcbiAgICAgICAgLy8gKioqKioqKioqKioqKioqKioqIFJlbmRlciBTVkcgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICAgIC8vIFZhcmlhYmxlIGRlY2xhcmF0aW9uXG4gICAgICAgIHZhciBjbHVzdGVycyA9IGNsdXN0O1xuICAgICAgICB2YXIgbGVtbWFEaWMgPSB0aGlzLmFuYWx5emVyLmdldCgnbGVtbWFEaWMnKTtcbiAgICAgICAgdmFyIGdyYXBoID0gYXBwLmdldExpbmtzTm9kZXMocGFpcnMpO1xuXG4gICAgICAgIC8vIC8vIEFkanVzdCBoZWlnaHQgb2Ygc3ZnXG4gICAgICAgIHZhciBzdmdIZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHZhciBzdmdXaWR0aCA9IHdpZHRoO1xuICAgICAgICB2YXIgd2luZG93SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuXG4gICAgICAgIC8vIFNldCBtYXJnaW4gYW5kIHdpZHRoXG4gICAgICAgIHZhciBtYXJnaW4gPSB7dG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCBsZWZ0OiAwfTtcblxuICAgICAgICAvLyBTZWxlY3Qgc3ZnXG4gICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3Qoc3ZnSUQpLmFwcGVuZChcInN2Z1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBzdmdXaWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgc3ZnSGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pO1xuXG4gICAgICAgIC8vIEFwcGVuZCByZWN0YW5nbGUgdG8gc3ZnXG4gICAgICAgIHZhciByZWN0ID0gc3ZnLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgc3ZnV2lkdGgpXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBzdmdIZWlnaHQpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgICAgICAgLnN0eWxlKFwicG9pbnRlci1ldmVudHNcIiwgXCJhbGxcIik7XG5cbiAgICAgICAgLy8gQ3JlYXRlIG5ldyBmb3JjZSBzaW11bGF0aW9uXG4gICAgICAgIHZhciBzaW11bGF0aW9uID0gZDMuZm9yY2VTaW11bGF0aW9uKClcbiAgICAgICAgICAgIC5mb3JjZSgnbGluaycsIGQzLmZvcmNlTGluaygpLmlkKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5pZDtcbiAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgLmZvcmNlKCdjaGFyZ2UnLCBkMy5mb3JjZU1hbnlCb2R5KCkuc3RyZW5ndGgoNTApKVxuICAgICAgICAgICAgLmZvcmNlKCdjZW50ZXInLCBkMy5mb3JjZUNlbnRlcihzdmdXaWR0aCAvIDIsIHN2Z0hlaWdodCAvIDIpKVxuICAgICAgICAgICAgLmZvcmNlKCdjb2xsaWRlJywgZDMuZm9yY2VDb2xsaWRlKDQwKS5pdGVyYXRpb25zKDYwKSk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAvLyBFbmFibGUgem9vbSBmdW5jdGlvbmFsaXR5IC8vXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgXG4gICAgICAgIC8vIENhbGwgem9vbVxuICAgICAgICBzdmcuY2FsbChkMy56b29tKClcbiAgICAgICAgICAgIC5zY2FsZUV4dGVudChbMSAvIDEwLCAxMF0pXG4gICAgICAgICAgICAub24oJ3pvb20nLCB6b29tZWQpKTtcblxuICAgICAgICAvLyBXcmFwIGV2ZXJ5dGhpbmcgaW4gZyBlbGVtZW50XG4gICAgICAgIHZhciBnID0gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIG1vdXNlb3ZlcilcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBtb3VzZW91dCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFpvb20gZnVuY3Rpb25cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHpvb21lZCgpIHtcbiAgICAgICAgICAgIGcuYXR0cigndHJhbnNmb3JtJywgZDMuZXZlbnQudHJhbnNmb3JtKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQWRkIGxpbmtzXG4gICAgICAgIHZhciBsaW5rID0gZy5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2xpbmtzJylcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoJ2xpbmUnKVxuICAgICAgICAgICAgLmRhdGEoZ3JhcGgubGlua3MpXG4gICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ2xpbmUnKTtcblxuICAgICAgICAvLyBDcmVhdGUgZyBlbGVtZW50IHRoYXQgc3RvcmVzXG4gICAgICAgIC8vIGNpcmNsZXMgYW5kIHRleHQgYW5kIGNhbGwgZHJhZ2dpbmcgb24gaXRcbiAgICAgICAgdmFyIG5vZGUgPSBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZXMnKVxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgICAgICAgLmRhdGEoZ3JhcGgubm9kZXMpXG4gICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ25vZGUnKVxuICAgICAgICAgICAgLmNhbGwoZDMuZHJhZygpXG4gICAgICAgICAgICAgICAgLm9uKCdzdGFydCcsIGRyYWdzdGFydGVkKVxuICAgICAgICAgICAgICAgIC5vbignZHJhZycsIGRyYWdnZWQpXG4gICAgICAgICAgICAgICAgLm9uKCdlbmQnLCBkcmFnZW5kZWQpKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFwcGVuZCBjaXJsZXMgdG8gbm9kZVxuICAgICAgICB2YXIgY2lyY2xlcyA9IG5vZGUuYXBwZW5kKCdjaXJjbGUnKVxuICAgICAgICAgICAgLy8gLmF0dHIoJ2NsYXNzJywgJ25vZGVzJylcbiAgICAgICAgICAgIC5hdHRyKCdyJywgMTUpXG4gICAgICAgICAgICAuYXR0cignY3gnLCAwKVxuICAgICAgICAgICAgLmF0dHIoJ2N5JywgMClcbiAgICAgICAgICAgIC8vIC5hdHRyKCdyeScsIDIpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uICh3b3JkKSB7XG4gICAgICAgICAgICAgICAgLy8gTG9vcCBvdmVyIGV2ZXJ5IGNsdXN0ZXJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNsdXN0ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgd29yZCBpcyBpbiBjdXJyZW50IEFycmF5XG4gICAgICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkod29yZC5pZCwgY2x1c3RlcnNbaV0pICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gY29sb3IgaWYgd29yZCB3YXIgZm91bmQgaW4gYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcnMoaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMC42KTtcblxuICAgICAgICAvLyBBcHBlbmQgbGFiZWwgdG8gbm9kZSBjb250YWluZXJcbiAgICAgICAgdmFyIGxhYmVsID0gbm9kZS5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgLmF0dHIoJ2R5JywgJy0uMzVlbScpXG4gICAgICAgICAgICAuYXR0cignZHgnLCAnMS40ZW0nKVxuICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmlkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIG5vZGVzIHRvIHNpbXVsYXRpb25cbiAgICAgICAgc2ltdWxhdGlvblxuICAgICAgICAgICAgLm5vZGVzKGdyYXBoLm5vZGVzKVxuICAgICAgICAgICAgLm9uKCd0aWNrJywgdGlja2VkKTtcblxuICAgICAgICAvLyBBZGQgbGlua3MgdG8gc2ltdWxhdGlvblxuICAgICAgICBzaW11bGF0aW9uLmZvcmNlKCdsaW5rJylcbiAgICAgICAgICAgIC5saW5rcyhncmFwaC5saW5rcyk7XG5cbiAgICAgICAgdmFyIGxpbmtlZEJ5SW5kZXggPSB7fTtcbiAgICAgICAgICAgIGxpbmsuZWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgbGlua2VkQnlJbmRleFtkLnNvdXJjZS5pbmRleCArIFwiLFwiICsgZC50YXJnZXQuaW5kZXhdID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaWNrIGZ1bmN0aW9uIGFkZHMgeCBhbmQgeVxuICAgICAgICAgKiBjb29yZGluYXRlcyB0byBub2RlcyBhbmQgbGlua3NcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHRpY2tlZCgpIHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBsaW5rc1xuICAgICAgICAgICAgbGlua1xuICAgICAgICAgICAgICAgIC5hdHRyKCd4MScsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc291cmNlLng7IH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3kxJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5zb3VyY2UueTsgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigneDInLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnRhcmdldC54OyB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lnk7IH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgbm9kZXNcbiAgICAgICAgICAgIG5vZGUuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBkLnggKyAnLCcgKyBkLnkgKyAnKSc7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYWdzdGFydGVkKGQpIHtcbiAgICAgICAgICAgIGlmICghZDMuZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDAuMykucmVzdGFydCgpO1xuICAgICAgICAgICAgZC5meCA9IGQueDtcbiAgICAgICAgICAgIGQuZnkgPSBkLnk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkcmFnZ2VkKGQpIHtcbiAgICAgICAgICAgIGQuZnggPSBkMy5ldmVudC54O1xuICAgICAgICAgICAgZC5meSA9IGQzLmV2ZW50Lnk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkcmFnZW5kZWQoZCkge1xuICAgICAgICAgICAgaWYgKCFkMy5ldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMCk7XG4gICAgICAgICAgICBkLmZ4ID0gbnVsbDtcbiAgICAgICAgICAgIGQuZnkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbW91c2VvdXQoKSB7XG4gICAgICAgICAgICAkKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicpLmZpbmQoJ3AnKS5lYWNoKGZ1bmN0aW9uKHBhcmFncmFwaCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXh0UGFyYWdyYXBoID0gJCh0aGlzKS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGV4dFBhcmFncmFwaCk7XG5cbiAgICAgICAgICAgICAgICAkKHRoaXMpLmh0bWwodGV4dFBhcmFncmFwaCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gR2V0IGFsbCBub2Rlc1xuICAgICAgICAgICAgdmFyIG5vZGVzID0gZDMuc2VsZWN0QWxsKCcubm9kZScpO1xuXG4gICAgICAgICAgICBub2Rlcy5zZWxlY3RBbGwoJ2NpcmNsZScpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMC42KVxuICAgICAgICAgICAgICAgIC5hdHRyKCdyJywgMTUpO1xuXG4gICAgICAgICAgICBub2Rlcy5zZWxlY3RBbGwoJ3RleHQnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnb3BhY2l0eScsIDApO1xuXG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5saW5rcycpLnNlbGVjdEFsbCgnbGluZScpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnI2NjYycpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtb3VzZW92ZXIoKSB7XG4gICAgICAgICAgICAvLyBHZXQgZGF0YVxuICAgICAgICAgICAgdmFyIG1vdXNlID0gZDMubW91c2UodGhpcyk7XG4gICAgICAgICAgICB2YXIgb2JqID0gc2ltdWxhdGlvbi5maW5kKG1vdXNlWzBdLCBtb3VzZVsxXSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgIC8vIFNlbGVjdGVkIGVsZW1lbnQgLy9cbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgIHZhciBub2RlU2VsZWN0ZWQgPSBkMy5zZWxlY3RBbGwoJy5ub2RlJylcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuaWQgPT0gb2JqLmlkO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgdGV4dFNlbGVjdGVkID0gbm9kZVNlbGVjdGVkLnNlbGVjdCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIDIwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC13ZWlnaHQnLCAnYm9sZCcpO1xuXG4gICAgICAgICAgICBub2RlU2VsZWN0ZWQuc2VsZWN0KCdjaXJjbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdyJywgMjUpO1xuXG4gICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgIC8vIEhpZ2hsaWdodCBhZGphY2VudCBub2RlcyAvL1xuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgICAgICBub2RlLnNlbGVjdEFsbCgnY2lyY2xlJylcbiAgICAgICAgICAgICAgICAvLyAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLy8gLmR1cmF0aW9uKDIwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnb3BhY2l0eScsIGZ1bmN0aW9uKGQpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQob2JqLCBkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMC42O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBub2RlLnNlbGVjdEFsbCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLy8gLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC8vIC5kdXJhdGlvbigyMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCBmdW5jdGlvbihkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29ubmVjdGVkKG9iaiwgZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgICAgICAvLyBIaWdobGlnaHQgbGlua3MgLy9cbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgbGlua1xuICAgICAgICAgICAgICAgIC8vIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAvLyAuZHVyYXRpb24oMjApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnNvdXJjZS5pZCA9PT0gb2JqLmlkIHx8IGQudGFyZ2V0LmlkID09PSBvYmouaWQgPyAnIzAwMCcgOiAnI2NjYyc7XG4gICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgICAgICAvLyBVbnNlbGVjdGVkIGVsZW1lbnQgLy9cbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgdmFyIG5vZGVVbnNlbGVjdGVkID0gZDMuc2VsZWN0QWxsKCcubm9kZScpXG4gICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmlkICE9IG9iai5pZDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbm9kZVVuc2VsZWN0ZWQuc2VsZWN0KCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIDE2KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC13ZWlnaHQnLCAnbm9ybWFsJyk7XG5cbiAgICAgICAgICAgIG5vZGVVbnNlbGVjdGVkLnNlbGVjdCgnY2lyY2xlJylcbiAgICAgICAgICAgICAgICAuYXR0cigncicsIDE1KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzQ29ubmVjdGVkKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBpc0Nvbm5lY3RlZEFzVGFyZ2V0KGEsIGIpIHx8IGlzQ29ubmVjdGVkQXNTb3VyY2UoYSwgYikgfHwgYS5pbmRleCA9PSBiLmluZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNDb25uZWN0ZWRBc1NvdXJjZShhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gbGlua2VkQnlJbmRleFthLmluZGV4ICsgXCIsXCIgKyBiLmluZGV4XTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzQ29ubmVjdGVkQXNUYXJnZXQoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGxpbmtlZEJ5SW5kZXhbYi5pbmRleCArIFwiLFwiICsgYS5pbmRleF07XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2F2ZVRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gR2V0IHNlY29uZHMgc3ViamVjdCB3b3JrZWQgZm9yIHJldmlzaW9uXG4gICAgICAgIHZhciByZXZpc2lvbkVsYXBzZWQgPSAobmV3IERhdGUoKSAtIHRoaXMucG9zdFBhZ2VEdXJhdGlvblN0YXJ0KSAvIDEwMDA7XG5cbiAgICAgICAgLy8gUmVuZGVyIGxvYWRpbmcgcmluZ1xuICAgICAgICB0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWZ1bGwtYnV0dG9uLWRpdicpLmh0bWwoXG4gICAgICAgICAgICBIYW5kbGViYXJzLnRlbXBsYXRlc1snbG9hZGluZy1yaW5nJ10oKSk7XG5cbiAgICAgICAgLy8gR2V0IHRleHRcbiAgICAgICAgdmFyIHRleHQgPSBhcHAuZ2V0UGFyYWdyYXBocyh0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicpKTtcblxuICAgICAgICAvLyBTYXZlIHBvc3QgdGV4dCB0byB0ZXh0TW9kZWxcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2V0KHsncG9zdF90ZXh0JzogdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zdF9wYWdlX2R1cmF0aW9uJzogcmV2aXNpb25FbGFwc2VkfSk7XG5cbiAgICAgICAgLy8gU2V0IHRleHQgdG8gYW5hbHl6ZXJcbiAgICAgICAgdGhpcy5hbmFseXplci5zZXQoeyd0ZXh0JzogdGV4dH0pO1xuXG4gICAgICAgIC8vIEZldGNoIGRhdGFcbiAgICAgICAgdGhpcy5hbmFseXplci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kVG9TZXJ2ZXIoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNlbmRUb1NlcnZlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFNhdmUgbGFzdCBkYXRhIFxuICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwb3N0X251bV9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fY2x1c3RlcnMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ2x1c3RlcnMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fbm9uX2NvaGVyZW50X3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdjb2hOb3RTZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb25jZXB0cyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1Db25jZXB0cycpfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBTZW5kIGRhdGEgdG8gc2VydmVyXG4gICAgICAgIHRoaXMudGV4dE1vZGVsLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbn0pO1xuXG5uZXcgYXBwLkNtYXBWaWV3KCk7XG4iXSwiZmlsZSI6ImNtYXAuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==\n"],"sourceRoot":"/source/"}