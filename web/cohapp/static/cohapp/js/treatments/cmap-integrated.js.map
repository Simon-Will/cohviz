{"version":3,"sources":["cmap-integrated.js"],"names":["app","CmapView","Backbone","View","extend","el","events","click #instruction-read","click #help","click #editor-button","click #editor-full-button","initialize","self","this","prePageDurationStart","postPageDurationStart","colors","d3","scaleOrdinal","schemeCategory10","userModel","UserSpecificModel","textModel","TextModelComplete","analyzer","TextAnalyzerModel","fetch","success","model","response","renderInstruction","error","console","log","$el","html","Handlebars","templates","instruction","get","renderEditor","Date","editor","MediumEditor","toolbar","placeholder","$","editableElement","document","querySelector","firstChild","selectElement","append","renderInstructionModal","openModal","analyzeText","regExText","text","getParagraphs","find","length","Materialize","toast","draftElapsed","set","pre_page_duration","pre_text","save","renderRevision","responseText","pre_num_sentences","pre_num_clusters","pre_num_coherent_sentences","pre_num_non_coherent_sentences","pre_num_concepts","paragraphs","constants","simpleRevisionModal","svgWidth","width","svgHeight","height","renderCmap","saveText","revisionElapsed","replace","post_text","post_page_duration","sendToServer","post_num_sentences","post_num_clusters","post_num_coherent_sentences","post_num_non_coherent_sentences","post_num_concepts","location","reload","pairs","clust","numClusters","svgID","zoomed","g","attr","event","transform","ticked","link","d","source","x","y","target","node","dragstarted","active","simulation","alphaTarget","restart","fx","fy","dragged","dragended","mouseout","each","paragraph","textParagraph","nodes","selectAll","style","mouseover","mouse","obj","nodeSelected","filter","id","textSelected","select","isConnected","nodeUnselected","wordSelected","wordsUnselected","push","index","indexOf","splice","highlightSelectedWord","lemmaDic","clusters","a","b","isConnectedAsTarget","isConnectedAsSource","linkedByIndex","graph","getLinksNodes","margin","window","top","right","bottom","left","svg","forceSimulation","force","forceLink","forceManyBody","strength","forceCenter","forceCollide","iterations","call","zoom","scaleExtent","on","data","links","enter","drag","word","i","inArray"],"mappings":"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","file":"cmap-integrated.js","sourcesContent":["var app = app || {};\n\n\napp.CmapView = Backbone.View.extend({\n\n    el: '#treatment-cmap-integrated',\n\n    events: {\n        'click #instruction-read': 'renderEditor',\n        'click #help': 'renderInstructionModal',\n        'click #editor-button': 'analyzeText',\n        'click #editor-full-button': 'saveText',\n    },\n\n    initialize: function() {\n        // Variable declaration\n        var self = this;\n        this.prePageDurationStart = null;\n        this.postPageDurationStart = null;\n\n        // Generate 20 distinct colors for the cmap\n        this.colors = d3.scaleOrdinal(d3.schemeCategory10);\n        \n        // Get user data\n        this.userModel = new app.UserSpecificModel();\n\n        // Init textanalyzer model\n        this.textModel = new app.TextModelComplete();\n\n        // Init textAnalyzer model\n        this.analyzer = new app.TextAnalyzerModel();\n\n        // Fetch user data\n        this.userModel.fetch({\n            success: function(model, response) {\n                self.renderInstruction();\n            },\n            error: function(model, response) {\n                console.log(response);\n            }\n        });\n\n    },\n\n    /** Render instruction for \n      * this part of the experiment\n      */\n    renderInstruction: function() {\n        // Render instruction\n        this.$el.html(\n            Handlebars.templates.instruction({'instruction':\n                this.userModel.get('instruction')}));\n    },\n\n    /** \n     * When user has read the instruction he or she is able\n     * to write their text.\n     */\n    renderEditor: function() {\n        // Start timer for draft\n        this.prePageDurationStart = new Date();\n\n        // Render editor\n        this.$el.html(Handlebars.templates.editor());\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-textinput', {\n            toolbar: false,\n            placeholder: false,\n        });\n\n        // Add text to editor\n        $('#editor-textinput').html('<p>Schreibe hier ...</p>');\n\n        // Select text so that user can type instantly\n        var editableElement = document.\n            querySelector('#editor-textinput').firstChild;\n        editor.selectElement(editableElement);\n\n        // Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal \n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instruction') }));\n    },\n\n    /**\n     * Render modal of instruction\n     */\n    renderInstructionModal: function() {\n        $('#modal-help').openModal();\n    },\n\n    /**\n     * After user has written his or her text the \n     * user gets feedback on the draft. \n     * Before users can see the feedback we need \n     * to make some sanity checks whether the \n     * text is long enough.\n     */\n    analyzeText: function() {\n        var self = this;\n\n        // Change text with major concepts\n        app.regExText('#editor-textinput');\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-textinput'));\n\n        // Check if text is long enough\n        if (text.length < 1000) {\n            // Display toast\n            Materialize.toast('Ihr Text ist leider zu kurz.', 4000);\n        } else {\n            // Stop timer for draft\n            var draftElapsed = (new Date() - this.prePageDurationStart) / 1000;\n\n            // Start timer for text revision\n            this.postPageDurationStart = new Date();\n\n            // Set draft time and draftText to textModel\n            this.textModel.set({'pre_page_duration': draftElapsed,\n                                'pre_text': text});\n\n            // Render loading ring\n            this.$el.find('#editor-button-div').html(\n                Handlebars.templates['loading-ring']());\n\n            // Get text data\n            this.analyzer.set({'text': text});\n            this.analyzer.save(null, {\n                success: function(response) {\n                    self.renderRevision();\n                },\n                error: function(model, response) {\n                    console.log(response.responseText);\n                }\n            });\n        }\n    },\n\n\n    /**\n     * After user has written the draft she gets the \n     * opportunity to revise her text\n     */\n    renderRevision: function() {\n        var self = this;\n\n        // Render submit button\n        this.$el.find('#editor-button-div').html(\n                '<a class=\"waves-effect waves-light btn\" id=\"save-text\">Text abschicken</a>');\n\n        // Save data for draft\n        this.textModel.set({'pre_text': this.analyzer.get('text'),\n            'pre_num_sentences': this.analyzer.get('numSentences'),\n            'pre_num_clusters': this.analyzer.get('numClusters'),\n            'pre_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'pre_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'pre_num_concepts': this.analyzer.get('numConcepts')});\n\n        // Get inner html of text input\n        this.paragraphs = $('#editor-textinput').html();\n\n        // Change inner html\n        this.$el.html(Handlebars.templates['editor-full']({'instruction':\n            app.constants.simpleRevisionModal}));\n\n        //  Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal \n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instructionreview') }));\n\n        // Change inner html of editor\n        $('#editor-full-medium-editor').html(this.paragraphs);\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-full-medium-editor', {\n            toolbar: false,\n        });\n\n        // Change text of Button\n        $('#editor-full-button').text('Text abschicken');\n\n        // Display modal\n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instructionreview')}));\n        $('#modal-help').openModal();\n\n        // Set width of height of svg element\n        var svgWidth = $('#editor-full-graph').width();\n        var svgHeight = $('#editor-full-medium-editor').height();\n\n        // Render graph\n        this.renderCmap(this.analyzer.get('word_pairs'),\n            this.analyzer.get('clusters'), this.analyzer.get('numClusters'),\n            '#editor-full-graph', svgHeight, svgWidth, this.colors);\n    },\n\n\n    saveText: function() {\n        var self = this;\n\n        // Get seconds subject worked for revision\n        var revisionElapsed = (new Date() - this.postPageDurationStart) / 1000;\n\n        // Render loading ring\n        this.$el.find('#editor-full-button-div').html(\n            Handlebars.templates['loading-ring']());\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-full-medium-editor'));\n\n        // Remove unnecessary white spaces\n        text = text.replace(/\\s\\,/g, ',');\n        text = text.replace(/\\s\\./g, '.');\n        text = text.replace(/\\s!/g, '!');\n        text = text.replace(/\\[\\s/g, '[');\n        text = text.replace(/\\s&/g, '&');\n        text = text.replace(/\\s`/g, '`');\n        text = text.replace(/\\s~/g, '~');\n        text = text.replace(/\\s;/g, ';');\n        text = text.replace(/\\s_/g, '_');\n        text = text.replace(/\\s]/g, ']');\n        text = text.replace(/\\s:/g, ':');\n        text = text.replace(/\\s\\?/g, '?');\n        text = text.replace(/\\(\\s/g, '(');\n        text = text.replace(/\\s\\)/g, ')');\n        text = text.replace(/\\s\\//g, '/');\n\n        // Save post text to textModel\n        this.textModel.set({'post_text': text,\n                            'post_page_duration': revisionElapsed});\n\n        // Set text to analyzer\n        this.analyzer.set({'text': text});\n\n        // Fetch data\n        this.analyzer.save(null, {\n            success: function(response) {\n                self.sendToServer();\n            },\n            error: function(model, response) {\n                console.log(response.responseText);\n            }\n        });\n    },\n\n    sendToServer: function() {\n        // Save last data \n        this.textModel.set({'post_num_sentences': this.analyzer.get('numSentences'),\n            'post_num_clusters': this.analyzer.get('numClusters'),\n            'post_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'post_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'post_num_concepts': this.analyzer.get('numConcepts')});\n        \n        // Send data to server\n        this.textModel.save(null, {\n            success: function(response) {\n                // Reload page\n                location.reload();\n            },\n            error: function(model, response) {\n                console.log('error');\n            }\n        });\n    },\n\n\n    renderCmap: function(pairs, clust, numClusters, svgID, height, width, colors)  {\n        var self = this;\n    \n        // ****************** Render SVG ***************************************\n        // Variable declaration\n        var clusters = clust;\n        var lemmaDic = this.analyzer.get('lemmaDic');\n        var graph = app.getLinksNodes(pairs);\n\n        // // Adjust height of svg\n        var svgHeight = height;\n        var svgWidth = width;\n        var windowHeight = $(window).height();\n\n        // Set margin and width\n        var margin = {top: 0, right: 0, bottom: 0, left: 0};\n\n        // Select svg\n        var svg = d3.select(svgID).append(\"svg\")\n            .attr(\"width\", svgWidth + margin.left + margin.right)\n            .attr(\"height\", svgHeight + margin.top + margin.bottom);\n\n        // Append rectangle to svg\n        var rect = svg.append(\"rect\")\n            .attr(\"width\", svgWidth)\n            .attr(\"height\", svgHeight)\n            .style(\"fill\", \"none\")\n            .style(\"pointer-events\", \"all\");\n\n        // Create new force simulation\n        var simulation = d3.forceSimulation()\n            .force('link', d3.forceLink().id(function(d) {\n                return d.id;\n            }))\n            .force('charge', d3.forceManyBody().strength(50))\n            .force('center', d3.forceCenter(svgWidth / 2, svgHeight / 2))\n            .force('collide', d3.forceCollide(40).iterations(60));\n\n        ///////////////////////////////\n        // Enable zoom functionality //\n        ///////////////////////////////\n        \n        // Call zoom\n        svg.call(d3.zoom()\n            .scaleExtent([1 / 10, 10])\n            .on('zoom', zoomed));\n\n        // Wrap everything in g element\n        var g = svg.append('g')\n            .on('mouseover', mouseover)\n            .on('mouseout', mouseout);\n\n        /**\n         * Zoom function\n         */\n        function zoomed() {\n            g.attr('transform', d3.event.transform);\n        }\n        \n        // Add links\n        var link = g.append('g')\n            .attr('class', 'links')\n            .selectAll('line')\n            .data(graph.links)\n            .enter().append('line');\n\n        // Create g element that stores\n        // circles and text and call dragging on it\n        var node = g.append('g')\n            .attr('class', 'nodes')\n            .selectAll('.node')\n            .data(graph.nodes)\n            .enter().append('g')\n            .attr('class', 'node')\n            .call(d3.drag()\n                .on('start', dragstarted)\n                .on('drag', dragged)\n                .on('end', dragended));\n        \n        // Append cirles to node\n        var circles = node.append('circle')\n            // .attr('class', 'nodes')\n            .attr('r', 15)\n            .attr('cx', 0)\n            .attr('cy', 0)\n            // .attr('ry', 2)\n            .style(\"fill\", function (word) {\n                // Loop over every cluster\n                for (var i = 0; i < clusters.length; i++) {\n                    // Check if current word is in current Array\n                    if ($.inArray(word.id, clusters[i]) != -1) {\n                        // Return color if word war found in array\n                        return colors(i);\n                    }\n                }\n            })\n            .style('opacity', 0.6);\n\n        // Append label to node container\n        var label = node.append('text')\n            .attr('dy', '-.35em')\n            .attr('dx', '1.4em')\n            .text(function(d) {\n                return d.id;\n            });\n\n        // Add nodes to simulation\n        simulation\n            .nodes(graph.nodes)\n            .on('tick', ticked);\n\n        // Add links to simulation\n        simulation.force('link')\n            .links(graph.links);\n\n        var linkedByIndex = {};\n            link.each(function(d) {\n                linkedByIndex[d.source.index + \",\" + d.target.index] = true;\n            });\n\n        /**\n         * Tick function adds x and y\n         * coordinates to nodes and links\n         */\n        function ticked() {\n            // Update links\n            link\n                .attr('x1', function(d) { return d.source.x; })\n                .attr('y1', function(d) { return d.source.y; })\n                .attr('x2', function(d) { return d.target.x; })\n                .attr('y2', function(d) { return d.target.y; });\n\n            // Update nodes\n            node.attr('transform', function(d) {\n                return 'translate(' + d.x + ',' + d.y + ')';\n            });\n        }\n\n        function dragstarted(d) {\n            if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n            d.fx = d.x;\n            d.fy = d.y;\n        }\n\n        function dragged(d) {\n            d.fx = d3.event.x;\n            d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n            if (!d3.event.active) simulation.alphaTarget(0);\n            d.fx = null;\n            d.fy = null;\n        }\n\n        function mouseout() {\n            $('#editor-full-medium-editor').find('p').each(function(paragraph) {\n                var textParagraph = $(this).text();\n                // console.log(textParagraph);\n\n                $(this).html(textParagraph);\n            });\n\n            // Get all nodes\n            var nodes = d3.selectAll('.node');\n\n            nodes.selectAll('circle')\n                .style('opacity', 0.6)\n                .attr('r', 15);\n\n            nodes.selectAll('text')\n                .style('opacity', 0);\n\n            d3.selectAll('.links').selectAll('line')\n                .style('stroke', '#ccc');\n\n        }\n\n        function mouseover() {\n            // Get data\n            var mouse = d3.mouse(this);\n            var obj = simulation.find(mouse[0], mouse[1]);\n            \n            //////////////////////\n            // Selected element //\n            //////////////////////\n            var nodeSelected = d3.selectAll('.node')\n                .filter(function(d) {\n                    return d.id == obj.id;\n                });\n\n            var textSelected = nodeSelected.select('text')\n                .style('opacity', 1)\n                .style('font-size', 20)\n                .style('font-weight', 'bold');\n\n            nodeSelected.select('circle')\n                .attr('r', 25);\n\n            //////////////////////////////\n            // Highlight adjacent nodes //\n            //////////////////////////////\n            node.selectAll('circle')\n                // .transition()\n                // .duration(20)\n                .style('opacity', function(d) {\n\n                    if (isConnected(obj, d)) {\n                        return 1;\n                    }\n\n                    return 0.6;\n                });\n\n            node.selectAll('text')\n                // .transition()\n                // .duration(20)\n                .style('opacity', function(d) {\n\n                    if (isConnected(obj, d)) {\n                        return 1;\n                    }\n\n                    return 0;\n\n                });\n\n            /////////////////////\n            // Highlight links //\n            /////////////////////\n            link\n                // .transition()\n                // .duration(20)\n                .style('stroke', function(d) {\n                    return d.source.id === obj.id || d.target.id === obj.id ? '#000' : '#ccc';\n                });\n\n\n            ////////////////////////\n            // Unselected element //\n            ////////////////////////\n            var nodeUnselected = d3.selectAll('.node')\n                .filter(function(d) {\n                    return d.id != obj.id;\n                });\n\n            nodeUnselected.select('text')\n                .style('font-size', 16)\n                .style('font-weight', 'normal');\n\n            nodeUnselected.select('circle')\n                .attr('r', 15);\n\n            /////////////////////////////\n            // Highlight words in text //\n            /////////////////////////////\n            \n            // We need to get the text of the selected word in order\n            // to highlight them\n            var wordSelected = textSelected.text();\n            \n            // Get all words that are semantically related\n            // to the selected word\n            var wordsUnselected = [];\n            node.selectAll('text')\n                .each(function(d) {\n                    if (isConnected(obj, d)) {\n                        wordsUnselected.push(d.id);\n                    }\n                });\n\n            // Remove selected word\n            var index = wordsUnselected.indexOf(wordSelected);\n\n            // Update unselected words without selected word\n            wordsUnselected.splice(index, 1);\n\n            app.highlightSelectedWord('#editor-full-medium-editor', wordSelected,\n                wordsUnselected, lemmaDic, clusters, self.colors);\n        }\n\n        function isConnected(a, b) {\n            return isConnectedAsTarget(a, b) || isConnectedAsSource(a, b) || a.index == b.index;\n        }\n\n        function isConnectedAsSource(a, b) {\n            return linkedByIndex[a.index + \",\" + b.index];\n        }\n\n        function isConnectedAsTarget(a, b) {\n            return linkedByIndex[b.index + \",\" + a.index];\n        }\n    }\n\n\n});\n\nnew app.CmapView();\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJjbWFwLWludGVncmF0ZWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuXG5hcHAuQ21hcFZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cbiAgICBlbDogJyN0cmVhdG1lbnQtY21hcC1pbnRlZ3JhdGVkJyxcblxuICAgIGV2ZW50czoge1xuICAgICAgICAnY2xpY2sgI2luc3RydWN0aW9uLXJlYWQnOiAncmVuZGVyRWRpdG9yJyxcbiAgICAgICAgJ2NsaWNrICNoZWxwJzogJ3JlbmRlckluc3RydWN0aW9uTW9kYWwnLFxuICAgICAgICAnY2xpY2sgI2VkaXRvci1idXR0b24nOiAnYW5hbHl6ZVRleHQnLFxuICAgICAgICAnY2xpY2sgI2VkaXRvci1mdWxsLWJ1dHRvbic6ICdzYXZlVGV4dCcsXG4gICAgfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBWYXJpYWJsZSBkZWNsYXJhdGlvblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMucHJlUGFnZUR1cmF0aW9uU3RhcnQgPSBudWxsO1xuICAgICAgICB0aGlzLnBvc3RQYWdlRHVyYXRpb25TdGFydCA9IG51bGw7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgMjAgZGlzdGluY3QgY29sb3JzIGZvciB0aGUgY21hcFxuICAgICAgICB0aGlzLmNvbG9ycyA9IGQzLnNjYWxlT3JkaW5hbChkMy5zY2hlbWVDYXRlZ29yeTEwKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCB1c2VyIGRhdGFcbiAgICAgICAgdGhpcy51c2VyTW9kZWwgPSBuZXcgYXBwLlVzZXJTcGVjaWZpY01vZGVsKCk7XG5cbiAgICAgICAgLy8gSW5pdCB0ZXh0YW5hbHl6ZXIgbW9kZWxcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwgPSBuZXcgYXBwLlRleHRNb2RlbENvbXBsZXRlKCk7XG5cbiAgICAgICAgLy8gSW5pdCB0ZXh0QW5hbHl6ZXIgbW9kZWxcbiAgICAgICAgdGhpcy5hbmFseXplciA9IG5ldyBhcHAuVGV4dEFuYWx5emVyTW9kZWwoKTtcblxuICAgICAgICAvLyBGZXRjaCB1c2VyIGRhdGFcbiAgICAgICAgdGhpcy51c2VyTW9kZWwuZmV0Y2goe1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXJJbnN0cnVjdGlvbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfSxcblxuICAgIC8qKiBSZW5kZXIgaW5zdHJ1Y3Rpb24gZm9yIFxuICAgICAgKiB0aGlzIHBhcnQgb2YgdGhlIGV4cGVyaW1lbnRcbiAgICAgICovXG4gICAgcmVuZGVySW5zdHJ1Y3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBSZW5kZXIgaW5zdHJ1Y3Rpb25cbiAgICAgICAgdGhpcy4kZWwuaHRtbChcbiAgICAgICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzLmluc3RydWN0aW9uKHsnaW5zdHJ1Y3Rpb24nOlxuICAgICAgICAgICAgICAgIHRoaXMudXNlck1vZGVsLmdldCgnaW5zdHJ1Y3Rpb24nKX0pKTtcbiAgICB9LFxuXG4gICAgLyoqIFxuICAgICAqIFdoZW4gdXNlciBoYXMgcmVhZCB0aGUgaW5zdHJ1Y3Rpb24gaGUgb3Igc2hlIGlzIGFibGVcbiAgICAgKiB0byB3cml0ZSB0aGVpciB0ZXh0LlxuICAgICAqL1xuICAgIHJlbmRlckVkaXRvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFN0YXJ0IHRpbWVyIGZvciBkcmFmdFxuICAgICAgICB0aGlzLnByZVBhZ2VEdXJhdGlvblN0YXJ0ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBSZW5kZXIgZWRpdG9yXG4gICAgICAgIHRoaXMuJGVsLmh0bWwoSGFuZGxlYmFycy50ZW1wbGF0ZXMuZWRpdG9yKCkpO1xuXG4gICAgICAgIC8vIEVuYWJsZSBlZGl0b3IgZnVuY3Rpb25hbGl0eVxuICAgICAgICB2YXIgZWRpdG9yID0gbmV3IE1lZGl1bUVkaXRvcignI2VkaXRvci10ZXh0aW5wdXQnLCB7XG4gICAgICAgICAgICB0b29sYmFyOiBmYWxzZSxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBmYWxzZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIHRleHQgdG8gZWRpdG9yXG4gICAgICAgICQoJyNlZGl0b3ItdGV4dGlucHV0JykuaHRtbCgnPHA+U2NocmVpYmUgaGllciAuLi48L3A+Jyk7XG5cbiAgICAgICAgLy8gU2VsZWN0IHRleHQgc28gdGhhdCB1c2VyIGNhbiB0eXBlIGluc3RhbnRseVxuICAgICAgICB2YXIgZWRpdGFibGVFbGVtZW50ID0gZG9jdW1lbnQuXG4gICAgICAgICAgICBxdWVyeVNlbGVjdG9yKCcjZWRpdG9yLXRleHRpbnB1dCcpLmZpcnN0Q2hpbGQ7XG4gICAgICAgIGVkaXRvci5zZWxlY3RFbGVtZW50KGVkaXRhYmxlRWxlbWVudCk7XG5cbiAgICAgICAgLy8gQXBwZW5kIGhlbHAgYnV0dG9uIHRvIHdpbmRvd1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoJzxpIGlkPVwiaGVscFwiIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5oZWxwPC9pPicpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBtb2RhbCBcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKEhhbmRsZWJhcnMudGVtcGxhdGVzWydtb2RhbC1oZWxwJ10oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICB0aGlzLnVzZXJNb2RlbC5nZXQoJ2luc3RydWN0aW9uJykgfSkpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW5kZXIgbW9kYWwgb2YgaW5zdHJ1Y3Rpb25cbiAgICAgKi9cbiAgICByZW5kZXJJbnN0cnVjdGlvbk1vZGFsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnI21vZGFsLWhlbHAnKS5vcGVuTW9kYWwoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWZ0ZXIgdXNlciBoYXMgd3JpdHRlbiBoaXMgb3IgaGVyIHRleHQgdGhlIFxuICAgICAqIHVzZXIgZ2V0cyBmZWVkYmFjayBvbiB0aGUgZHJhZnQuIFxuICAgICAqIEJlZm9yZSB1c2VycyBjYW4gc2VlIHRoZSBmZWVkYmFjayB3ZSBuZWVkIFxuICAgICAqIHRvIG1ha2Ugc29tZSBzYW5pdHkgY2hlY2tzIHdoZXRoZXIgdGhlIFxuICAgICAqIHRleHQgaXMgbG9uZyBlbm91Z2guXG4gICAgICovXG4gICAgYW5hbHl6ZVRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHRleHQgd2l0aCBtYWpvciBjb25jZXB0c1xuICAgICAgICBhcHAucmVnRXhUZXh0KCcjZWRpdG9yLXRleHRpbnB1dCcpO1xuXG4gICAgICAgIC8vIEdldCB0ZXh0XG4gICAgICAgIHZhciB0ZXh0ID0gYXBwLmdldFBhcmFncmFwaHModGhpcy4kZWwuZmluZCgnI2VkaXRvci10ZXh0aW5wdXQnKSk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdGV4dCBpcyBsb25nIGVub3VnaFxuICAgICAgICBpZiAodGV4dC5sZW5ndGggPCAxMDAwKSB7XG4gICAgICAgICAgICAvLyBEaXNwbGF5IHRvYXN0XG4gICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnSWhyIFRleHQgaXN0IGxlaWRlciB6dSBrdXJ6LicsIDQwMDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gU3RvcCB0aW1lciBmb3IgZHJhZnRcbiAgICAgICAgICAgIHZhciBkcmFmdEVsYXBzZWQgPSAobmV3IERhdGUoKSAtIHRoaXMucHJlUGFnZUR1cmF0aW9uU3RhcnQpIC8gMTAwMDtcblxuICAgICAgICAgICAgLy8gU3RhcnQgdGltZXIgZm9yIHRleHQgcmV2aXNpb25cbiAgICAgICAgICAgIHRoaXMucG9zdFBhZ2VEdXJhdGlvblN0YXJ0ID0gbmV3IERhdGUoKTtcblxuICAgICAgICAgICAgLy8gU2V0IGRyYWZ0IHRpbWUgYW5kIGRyYWZ0VGV4dCB0byB0ZXh0TW9kZWxcbiAgICAgICAgICAgIHRoaXMudGV4dE1vZGVsLnNldCh7J3ByZV9wYWdlX2R1cmF0aW9uJzogZHJhZnRFbGFwc2VkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJlX3RleHQnOiB0ZXh0fSk7XG5cbiAgICAgICAgICAgIC8vIFJlbmRlciBsb2FkaW5nIHJpbmdcbiAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItYnV0dG9uLWRpdicpLmh0bWwoXG4gICAgICAgICAgICAgICAgSGFuZGxlYmFycy50ZW1wbGF0ZXNbJ2xvYWRpbmctcmluZyddKCkpO1xuXG4gICAgICAgICAgICAvLyBHZXQgdGV4dCBkYXRhXG4gICAgICAgICAgICB0aGlzLmFuYWx5emVyLnNldCh7J3RleHQnOiB0ZXh0fSk7XG4gICAgICAgICAgICB0aGlzLmFuYWx5emVyLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyUmV2aXNpb24oKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIC8qKlxuICAgICAqIEFmdGVyIHVzZXIgaGFzIHdyaXR0ZW4gdGhlIGRyYWZ0IHNoZSBnZXRzIHRoZSBcbiAgICAgKiBvcHBvcnR1bml0eSB0byByZXZpc2UgaGVyIHRleHRcbiAgICAgKi9cbiAgICByZW5kZXJSZXZpc2lvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyBSZW5kZXIgc3VibWl0IGJ1dHRvblxuICAgICAgICB0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWJ1dHRvbi1kaXYnKS5odG1sKFxuICAgICAgICAgICAgICAgICc8YSBjbGFzcz1cIndhdmVzLWVmZmVjdCB3YXZlcy1saWdodCBidG5cIiBpZD1cInNhdmUtdGV4dFwiPlRleHQgYWJzY2hpY2tlbjwvYT4nKTtcblxuICAgICAgICAvLyBTYXZlIGRhdGEgZm9yIGRyYWZ0XG4gICAgICAgIHRoaXMudGV4dE1vZGVsLnNldCh7J3ByZV90ZXh0JzogdGhpcy5hbmFseXplci5nZXQoJ3RleHQnKSxcbiAgICAgICAgICAgICdwcmVfbnVtX3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1TZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwcmVfbnVtX2NsdXN0ZXJzJzogdGhpcy5hbmFseXplci5nZXQoJ251bUNsdXN0ZXJzJyksXG4gICAgICAgICAgICAncHJlX251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncHJlX251bV9ub25fY29oZXJlbnRfc2VudGVuY2VzJzogdGhpcy5hbmFseXplci5nZXQoJ2NvaE5vdFNlbnRlbmNlcycpLFxuICAgICAgICAgICAgJ3ByZV9udW1fY29uY2VwdHMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ29uY2VwdHMnKX0pO1xuXG4gICAgICAgIC8vIEdldCBpbm5lciBodG1sIG9mIHRleHQgaW5wdXRcbiAgICAgICAgdGhpcy5wYXJhZ3JhcGhzID0gJCgnI2VkaXRvci10ZXh0aW5wdXQnKS5odG1sKCk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIGlubmVyIGh0bWxcbiAgICAgICAgdGhpcy4kZWwuaHRtbChIYW5kbGViYXJzLnRlbXBsYXRlc1snZWRpdG9yLWZ1bGwnXSh7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgIGFwcC5jb25zdGFudHMuc2ltcGxlUmV2aXNpb25Nb2RhbH0pKTtcblxuICAgICAgICAvLyAgQXBwZW5kIGhlbHAgYnV0dG9uIHRvIHdpbmRvd1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoJzxpIGlkPVwiaGVscFwiIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5oZWxwPC9pPicpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBtb2RhbCBcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKEhhbmRsZWJhcnMudGVtcGxhdGVzWydtb2RhbC1oZWxwJ10oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICB0aGlzLnVzZXJNb2RlbC5nZXQoJ2luc3RydWN0aW9ucmV2aWV3JykgfSkpO1xuXG4gICAgICAgIC8vIENoYW5nZSBpbm5lciBodG1sIG9mIGVkaXRvclxuICAgICAgICAkKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicpLmh0bWwodGhpcy5wYXJhZ3JhcGhzKTtcblxuICAgICAgICAvLyBFbmFibGUgZWRpdG9yIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgdmFyIGVkaXRvciA9IG5ldyBNZWRpdW1FZGl0b3IoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJywge1xuICAgICAgICAgICAgdG9vbGJhcjogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoYW5nZSB0ZXh0IG9mIEJ1dHRvblxuICAgICAgICAkKCcjZWRpdG9yLWZ1bGwtYnV0dG9uJykudGV4dCgnVGV4dCBhYnNjaGlja2VuJyk7XG5cbiAgICAgICAgLy8gRGlzcGxheSBtb2RhbFxuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoSGFuZGxlYmFycy50ZW1wbGF0ZXNbJ21vZGFsLWhlbHAnXSh7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgIHRoaXMudXNlck1vZGVsLmdldCgnaW5zdHJ1Y3Rpb25yZXZpZXcnKX0pKTtcbiAgICAgICAgJCgnI21vZGFsLWhlbHAnKS5vcGVuTW9kYWwoKTtcblxuICAgICAgICAvLyBTZXQgd2lkdGggb2YgaGVpZ2h0IG9mIHN2ZyBlbGVtZW50XG4gICAgICAgIHZhciBzdmdXaWR0aCA9ICQoJyNlZGl0b3ItZnVsbC1ncmFwaCcpLndpZHRoKCk7XG4gICAgICAgIHZhciBzdmdIZWlnaHQgPSAkKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicpLmhlaWdodCgpO1xuXG4gICAgICAgIC8vIFJlbmRlciBncmFwaFxuICAgICAgICB0aGlzLnJlbmRlckNtYXAodGhpcy5hbmFseXplci5nZXQoJ3dvcmRfcGFpcnMnKSxcbiAgICAgICAgICAgIHRoaXMuYW5hbHl6ZXIuZ2V0KCdjbHVzdGVycycpLCB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ2x1c3RlcnMnKSxcbiAgICAgICAgICAgICcjZWRpdG9yLWZ1bGwtZ3JhcGgnLCBzdmdIZWlnaHQsIHN2Z1dpZHRoLCB0aGlzLmNvbG9ycyk7XG4gICAgfSxcblxuXG4gICAgc2F2ZVRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gR2V0IHNlY29uZHMgc3ViamVjdCB3b3JrZWQgZm9yIHJldmlzaW9uXG4gICAgICAgIHZhciByZXZpc2lvbkVsYXBzZWQgPSAobmV3IERhdGUoKSAtIHRoaXMucG9zdFBhZ2VEdXJhdGlvblN0YXJ0KSAvIDEwMDA7XG5cbiAgICAgICAgLy8gUmVuZGVyIGxvYWRpbmcgcmluZ1xuICAgICAgICB0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWZ1bGwtYnV0dG9uLWRpdicpLmh0bWwoXG4gICAgICAgICAgICBIYW5kbGViYXJzLnRlbXBsYXRlc1snbG9hZGluZy1yaW5nJ10oKSk7XG5cbiAgICAgICAgLy8gR2V0IHRleHRcbiAgICAgICAgdmFyIHRleHQgPSBhcHAuZ2V0UGFyYWdyYXBocyh0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWZ1bGwtbWVkaXVtLWVkaXRvcicpKTtcblxuICAgICAgICAvLyBSZW1vdmUgdW5uZWNlc3Nhcnkgd2hpdGUgc3BhY2VzXG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc1xcLC9nLCAnLCcpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHNcXC4vZywgJy4nKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzIS9nLCAnIScpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXFtcXHMvZywgJ1snKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzJi9nLCAnJicpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHNgL2csICdgJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc34vZywgJ34nKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzOy9nLCAnOycpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHNfL2csICdfJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc10vZywgJ10nKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzOi9nLCAnOicpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHNcXD8vZywgJz8nKTtcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFwoXFxzL2csICcoJyk7XG4gICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcc1xcKS9nLCAnKScpO1xuICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHNcXC8vZywgJy8nKTtcblxuICAgICAgICAvLyBTYXZlIHBvc3QgdGV4dCB0byB0ZXh0TW9kZWxcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2V0KHsncG9zdF90ZXh0JzogdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zdF9wYWdlX2R1cmF0aW9uJzogcmV2aXNpb25FbGFwc2VkfSk7XG5cbiAgICAgICAgLy8gU2V0IHRleHQgdG8gYW5hbHl6ZXJcbiAgICAgICAgdGhpcy5hbmFseXplci5zZXQoeyd0ZXh0JzogdGV4dH0pO1xuXG4gICAgICAgIC8vIEZldGNoIGRhdGFcbiAgICAgICAgdGhpcy5hbmFseXplci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kVG9TZXJ2ZXIoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNlbmRUb1NlcnZlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFNhdmUgbGFzdCBkYXRhIFxuICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwb3N0X251bV9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fY2x1c3RlcnMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ2x1c3RlcnMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fbm9uX2NvaGVyZW50X3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdjb2hOb3RTZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb25jZXB0cyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1Db25jZXB0cycpfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBTZW5kIGRhdGEgdG8gc2VydmVyXG4gICAgICAgIHRoaXMudGV4dE1vZGVsLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuXG4gICAgcmVuZGVyQ21hcDogZnVuY3Rpb24ocGFpcnMsIGNsdXN0LCBudW1DbHVzdGVycywgc3ZnSUQsIGhlaWdodCwgd2lkdGgsIGNvbG9ycykgIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFxuICAgICAgICAvLyAqKioqKioqKioqKioqKioqKiogUmVuZGVyIFNWRyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgICAgLy8gVmFyaWFibGUgZGVjbGFyYXRpb25cbiAgICAgICAgdmFyIGNsdXN0ZXJzID0gY2x1c3Q7XG4gICAgICAgIHZhciBsZW1tYURpYyA9IHRoaXMuYW5hbHl6ZXIuZ2V0KCdsZW1tYURpYycpO1xuICAgICAgICB2YXIgZ3JhcGggPSBhcHAuZ2V0TGlua3NOb2RlcyhwYWlycyk7XG5cbiAgICAgICAgLy8gLy8gQWRqdXN0IGhlaWdodCBvZiBzdmdcbiAgICAgICAgdmFyIHN2Z0hlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdmFyIHN2Z1dpZHRoID0gd2lkdGg7XG4gICAgICAgIHZhciB3aW5kb3dIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG5cbiAgICAgICAgLy8gU2V0IG1hcmdpbiBhbmQgd2lkdGhcbiAgICAgICAgdmFyIG1hcmdpbiA9IHt0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDAsIGxlZnQ6IDB9O1xuXG4gICAgICAgIC8vIFNlbGVjdCBzdmdcbiAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChzdmdJRCkuYXBwZW5kKFwic3ZnXCIpXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHN2Z1dpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBzdmdIZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSk7XG5cbiAgICAgICAgLy8gQXBwZW5kIHJlY3RhbmdsZSB0byBzdmdcbiAgICAgICAgdmFyIHJlY3QgPSBzdmcuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBzdmdXaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHN2Z0hlaWdodClcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJwb2ludGVyLWV2ZW50c1wiLCBcImFsbFwiKTtcblxuICAgICAgICAvLyBDcmVhdGUgbmV3IGZvcmNlIHNpbXVsYXRpb25cbiAgICAgICAgdmFyIHNpbXVsYXRpb24gPSBkMy5mb3JjZVNpbXVsYXRpb24oKVxuICAgICAgICAgICAgLmZvcmNlKCdsaW5rJywgZDMuZm9yY2VMaW5rKCkuaWQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmlkO1xuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAuZm9yY2UoJ2NoYXJnZScsIGQzLmZvcmNlTWFueUJvZHkoKS5zdHJlbmd0aCg1MCkpXG4gICAgICAgICAgICAuZm9yY2UoJ2NlbnRlcicsIGQzLmZvcmNlQ2VudGVyKHN2Z1dpZHRoIC8gMiwgc3ZnSGVpZ2h0IC8gMikpXG4gICAgICAgICAgICAuZm9yY2UoJ2NvbGxpZGUnLCBkMy5mb3JjZUNvbGxpZGUoNDApLml0ZXJhdGlvbnMoNjApKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgIC8vIEVuYWJsZSB6b29tIGZ1bmN0aW9uYWxpdHkgLy9cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsbCB6b29tXG4gICAgICAgIHN2Zy5jYWxsKGQzLnpvb20oKVxuICAgICAgICAgICAgLnNjYWxlRXh0ZW50KFsxIC8gMTAsIDEwXSlcbiAgICAgICAgICAgIC5vbignem9vbScsIHpvb21lZCkpO1xuXG4gICAgICAgIC8vIFdyYXAgZXZlcnl0aGluZyBpbiBnIGVsZW1lbnRcbiAgICAgICAgdmFyIGcgPSBzdmcuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgbW91c2VvdmVyKVxuICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIG1vdXNlb3V0KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogWm9vbSBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gem9vbWVkKCkge1xuICAgICAgICAgICAgZy5hdHRyKCd0cmFuc2Zvcm0nLCBkMy5ldmVudC50cmFuc2Zvcm0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgbGlua3NcbiAgICAgICAgdmFyIGxpbmsgPSBnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGlua3MnKVxuICAgICAgICAgICAgLnNlbGVjdEFsbCgnbGluZScpXG4gICAgICAgICAgICAuZGF0YShncmFwaC5saW5rcylcbiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgnbGluZScpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBnIGVsZW1lbnQgdGhhdCBzdG9yZXNcbiAgICAgICAgLy8gY2lyY2xlcyBhbmQgdGV4dCBhbmQgY2FsbCBkcmFnZ2luZyBvbiBpdFxuICAgICAgICB2YXIgbm9kZSA9IGcuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdub2RlcycpXG4gICAgICAgICAgICAuc2VsZWN0QWxsKCcubm9kZScpXG4gICAgICAgICAgICAuZGF0YShncmFwaC5ub2RlcylcbiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbm9kZScpXG4gICAgICAgICAgICAuY2FsbChkMy5kcmFnKClcbiAgICAgICAgICAgICAgICAub24oJ3N0YXJ0JywgZHJhZ3N0YXJ0ZWQpXG4gICAgICAgICAgICAgICAgLm9uKCdkcmFnJywgZHJhZ2dlZClcbiAgICAgICAgICAgICAgICAub24oJ2VuZCcsIGRyYWdlbmRlZCkpO1xuICAgICAgICBcbiAgICAgICAgLy8gQXBwZW5kIGNpcmxlcyB0byBub2RlXG4gICAgICAgIHZhciBjaXJjbGVzID0gbm9kZS5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAgICAgICAvLyAuYXR0cignY2xhc3MnLCAnbm9kZXMnKVxuICAgICAgICAgICAgLmF0dHIoJ3InLCAxNSlcbiAgICAgICAgICAgIC5hdHRyKCdjeCcsIDApXG4gICAgICAgICAgICAuYXR0cignY3knLCAwKVxuICAgICAgICAgICAgLy8gLmF0dHIoJ3J5JywgMilcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24gKHdvcmQpIHtcbiAgICAgICAgICAgICAgICAvLyBMb29wIG92ZXIgZXZlcnkgY2x1c3RlclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2x1c3RlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgY3VycmVudCB3b3JkIGlzIGluIGN1cnJlbnQgQXJyYXlcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheSh3b3JkLmlkLCBjbHVzdGVyc1tpXSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJldHVybiBjb2xvciBpZiB3b3JkIHdhciBmb3VuZCBpbiBhcnJheVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9ycyhpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCAwLjYpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBsYWJlbCB0byBub2RlIGNvbnRhaW5lclxuICAgICAgICB2YXIgbGFiZWwgPSBub2RlLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAuYXR0cignZHknLCAnLS4zNWVtJylcbiAgICAgICAgICAgIC5hdHRyKCdkeCcsICcxLjRlbScpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuaWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBBZGQgbm9kZXMgdG8gc2ltdWxhdGlvblxuICAgICAgICBzaW11bGF0aW9uXG4gICAgICAgICAgICAubm9kZXMoZ3JhcGgubm9kZXMpXG4gICAgICAgICAgICAub24oJ3RpY2snLCB0aWNrZWQpO1xuXG4gICAgICAgIC8vIEFkZCBsaW5rcyB0byBzaW11bGF0aW9uXG4gICAgICAgIHNpbXVsYXRpb24uZm9yY2UoJ2xpbmsnKVxuICAgICAgICAgICAgLmxpbmtzKGdyYXBoLmxpbmtzKTtcblxuICAgICAgICB2YXIgbGlua2VkQnlJbmRleCA9IHt9O1xuICAgICAgICAgICAgbGluay5lYWNoKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICBsaW5rZWRCeUluZGV4W2Quc291cmNlLmluZGV4ICsgXCIsXCIgKyBkLnRhcmdldC5pbmRleF0gPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRpY2sgZnVuY3Rpb24gYWRkcyB4IGFuZCB5XG4gICAgICAgICAqIGNvb3JkaW5hdGVzIHRvIG5vZGVzIGFuZCBsaW5rc1xuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gdGlja2VkKCkge1xuICAgICAgICAgICAgLy8gVXBkYXRlIGxpbmtzXG4gICAgICAgICAgICBsaW5rXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gxJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5zb3VyY2UueDsgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnNvdXJjZS55OyB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lng7IH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50YXJnZXQueTsgfSk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBub2Rlc1xuICAgICAgICAgICAgbm9kZS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGQueCArICcsJyArIGQueSArICcpJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZCkge1xuICAgICAgICAgICAgaWYgKCFkMy5ldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMC4zKS5yZXN0YXJ0KCk7XG4gICAgICAgICAgICBkLmZ4ID0gZC54O1xuICAgICAgICAgICAgZC5meSA9IGQueTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYWdnZWQoZCkge1xuICAgICAgICAgICAgZC5meCA9IGQzLmV2ZW50Lng7XG4gICAgICAgICAgICBkLmZ5ID0gZDMuZXZlbnQueTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChkKSB7XG4gICAgICAgICAgICBpZiAoIWQzLmV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwKTtcbiAgICAgICAgICAgIGQuZnggPSBudWxsO1xuICAgICAgICAgICAgZC5meSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtb3VzZW91dCgpIHtcbiAgICAgICAgICAgICQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJykuZmluZCgncCcpLmVhY2goZnVuY3Rpb24ocGFyYWdyYXBoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleHRQYXJhZ3JhcGggPSAkKHRoaXMpLnRleHQoKTtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0ZXh0UGFyYWdyYXBoKTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuaHRtbCh0ZXh0UGFyYWdyYXBoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBHZXQgYWxsIG5vZGVzXG4gICAgICAgICAgICB2YXIgbm9kZXMgPSBkMy5zZWxlY3RBbGwoJy5ub2RlJyk7XG5cbiAgICAgICAgICAgIG5vZGVzLnNlbGVjdEFsbCgnY2lyY2xlJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCAwLjYpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3InLCAxNSk7XG5cbiAgICAgICAgICAgIG5vZGVzLnNlbGVjdEFsbCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgMCk7XG5cbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmxpbmtzJykuc2VsZWN0QWxsKCdsaW5lJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjY2NjJyk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1vdXNlb3ZlcigpIHtcbiAgICAgICAgICAgIC8vIEdldCBkYXRhXG4gICAgICAgICAgICB2YXIgbW91c2UgPSBkMy5tb3VzZSh0aGlzKTtcbiAgICAgICAgICAgIHZhciBvYmogPSBzaW11bGF0aW9uLmZpbmQobW91c2VbMF0sIG1vdXNlWzFdKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgLy8gU2VsZWN0ZWQgZWxlbWVudCAvL1xuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgdmFyIG5vZGVTZWxlY3RlZCA9IGQzLnNlbGVjdEFsbCgnLm5vZGUnKVxuICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5pZCA9PSBvYmouaWQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciB0ZXh0U2VsZWN0ZWQgPSBub2RlU2VsZWN0ZWQuc2VsZWN0KCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ29wYWNpdHknLCAxKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgMjApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXdlaWdodCcsICdib2xkJyk7XG5cbiAgICAgICAgICAgIG5vZGVTZWxlY3RlZC5zZWxlY3QoJ2NpcmNsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3InLCAyNSk7XG5cbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgLy8gSGlnaGxpZ2h0IGFkamFjZW50IG5vZGVzIC8vXG4gICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgIG5vZGUuc2VsZWN0QWxsKCdjaXJjbGUnKVxuICAgICAgICAgICAgICAgIC8vIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAvLyAuZHVyYXRpb24oMjApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdvcGFjaXR5JywgZnVuY3Rpb24oZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0Nvbm5lY3RlZChvYmosIGQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwLjY7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG5vZGUuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAvLyAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLy8gLmR1cmF0aW9uKDIwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnb3BhY2l0eScsIGZ1bmN0aW9uKGQpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQob2JqLCBkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgIC8vIEhpZ2hsaWdodCBsaW5rcyAvL1xuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgICAgICBsaW5rXG4gICAgICAgICAgICAgICAgLy8gLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC8vIC5kdXJhdGlvbigyMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc291cmNlLmlkID09PSBvYmouaWQgfHwgZC50YXJnZXQuaWQgPT09IG9iai5pZCA/ICcjMDAwJyA6ICcjY2NjJztcbiAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgICAgIC8vIFVuc2VsZWN0ZWQgZWxlbWVudCAvL1xuICAgICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgICAgICB2YXIgbm9kZVVuc2VsZWN0ZWQgPSBkMy5zZWxlY3RBbGwoJy5ub2RlJylcbiAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuaWQgIT0gb2JqLmlkO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBub2RlVW5zZWxlY3RlZC5zZWxlY3QoJ3RleHQnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgMTYpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXdlaWdodCcsICdub3JtYWwnKTtcblxuICAgICAgICAgICAgbm9kZVVuc2VsZWN0ZWQuc2VsZWN0KCdjaXJjbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdyJywgMTUpO1xuXG4gICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAgICAgLy8gSGlnaGxpZ2h0IHdvcmRzIGluIHRleHQgLy9cbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZ2V0IHRoZSB0ZXh0IG9mIHRoZSBzZWxlY3RlZCB3b3JkIGluIG9yZGVyXG4gICAgICAgICAgICAvLyB0byBoaWdobGlnaHQgdGhlbVxuICAgICAgICAgICAgdmFyIHdvcmRTZWxlY3RlZCA9IHRleHRTZWxlY3RlZC50ZXh0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEdldCBhbGwgd29yZHMgdGhhdCBhcmUgc2VtYW50aWNhbGx5IHJlbGF0ZWRcbiAgICAgICAgICAgIC8vIHRvIHRoZSBzZWxlY3RlZCB3b3JkXG4gICAgICAgICAgICB2YXIgd29yZHNVbnNlbGVjdGVkID0gW107XG4gICAgICAgICAgICBub2RlLnNlbGVjdEFsbCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb25uZWN0ZWQob2JqLCBkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHNVbnNlbGVjdGVkLnB1c2goZC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHNlbGVjdGVkIHdvcmRcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHdvcmRzVW5zZWxlY3RlZC5pbmRleE9mKHdvcmRTZWxlY3RlZCk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB1bnNlbGVjdGVkIHdvcmRzIHdpdGhvdXQgc2VsZWN0ZWQgd29yZFxuICAgICAgICAgICAgd29yZHNVbnNlbGVjdGVkLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgIGFwcC5oaWdobGlnaHRTZWxlY3RlZFdvcmQoJyNlZGl0b3ItZnVsbC1tZWRpdW0tZWRpdG9yJywgd29yZFNlbGVjdGVkLFxuICAgICAgICAgICAgICAgIHdvcmRzVW5zZWxlY3RlZCwgbGVtbWFEaWMsIGNsdXN0ZXJzLCBzZWxmLmNvbG9ycyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0Nvbm5lY3RlZChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNDb25uZWN0ZWRBc1RhcmdldChhLCBiKSB8fCBpc0Nvbm5lY3RlZEFzU291cmNlKGEsIGIpIHx8IGEuaW5kZXggPT0gYi5pbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzQ29ubmVjdGVkQXNTb3VyY2UoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGxpbmtlZEJ5SW5kZXhbYS5pbmRleCArIFwiLFwiICsgYi5pbmRleF07XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0Nvbm5lY3RlZEFzVGFyZ2V0KGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBsaW5rZWRCeUluZGV4W2IuaW5kZXggKyBcIixcIiArIGEuaW5kZXhdO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn0pO1xuXG5uZXcgYXBwLkNtYXBWaWV3KCk7XG4iXSwiZmlsZSI6ImNtYXAtaW50ZWdyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9\n"],"sourceRoot":"/source/"}