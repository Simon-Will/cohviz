{"version":3,"sources":["text-integrated.js"],"names":["app","TextIntegratedView","Backbone","View","extend","el","events","click #instruction-read","click #help","click #editor-button","click #editor-full-button","initialize","self","this","prePageDurationStart","postPageDurationStart","colors","d3","scaleOrdinal","schemeCategory10","userModel","UserSpecificModel","textModel","TextModelComplete","analyzer","TextAnalyzerModel","fetch","success","model","response","renderInstruction","error","console","log","$el","html","Handlebars","templates","instruction","get","renderEditor","Date","editor","MediumEditor","toolbar","placeholder","$","editableElement","document","querySelector","firstChild","selectElement","append","renderInstructionModal","openModal","analyzeText","regExText","text","getParagraphs","find","length","Materialize","toast","draftElapsed","set","pre_page_duration","pre_text","save","renderRevision","responseText","pre_num_sentences","pre_num_clusters","pre_num_coherent_sentences","pre_num_non_coherent_sentences","pre_num_concepts","paragraphs","highlightWholeText","saveText","revisionElapsed","post_text","post_page_duration","sendToServer","post_num_sentences","post_num_clusters","post_num_coherent_sentences","post_num_non_coherent_sentences","post_num_concepts","location","reload"],"mappings":"AAAA,GAAIA,KAAMA,OAEVA,KAAIC,mBAAqBC,SAASC,KAAKC,QAEnCC,GAAI,6BAEJC,QACIC,0BAA2B,eAC3BC,cAAe,yBACfC,uBAAwB,cACxBC,4BAA6B,YAGjCC,WAAY,WAER,GAAIC,GAAOC,IACXA,MAAKC,qBAAuB,KAC5BD,KAAKE,sBAAwB,KAG7BF,KAAKG,OAASC,GAAGC,aAAaD,GAAGE,kBAGjCN,KAAKO,UAAY,GAAIpB,KAAIqB,kBAGzBR,KAAKS,UAAY,GAAItB,KAAIuB,kBAGzBV,KAAKW,SAAW,GAAIxB,KAAIyB,kBAGxBZ,KAAKO,UAAUM,OACXC,QAAS,SAASC,EAAOC,GACrBjB,EAAKkB,qBAETC,MAAO,SAASH,EAAOC,GACnBG,QAAQC,IAAIJ,OAQxBC,kBAAmB,WAEfjB,KAAKqB,IAAIC,KACLC,WAAWC,UAAUC,aAAaA,YAC9BzB,KAAKO,UAAUmB,IAAI,mBAO/BC,aAAc,WAEV3B,KAAKC,qBAAuB,GAAI2B,MAGhC5B,KAAKqB,IAAIC,KAAKC,WAAWC,UAAUK,SAGnC,IAAIA,GAAS,GAAIC,cAAa,qBAC1BC,SAAS,EACTC,aAAa,GAIjBC,GAAE,qBAAqBX,KAAK,2BAG5B,IAAIY,GAAkBC,SAClBC,cAAc,qBAAqBC,UACvCR,GAAOS,cAAcJ,GAGrBlC,KAAKqB,IAAIkB,OAAO,gDAGhBvC,KAAKqB,IAAIkB,OAAOhB,WAAWC,UAAU,eAAeC,YAChDzB,KAAKO,UAAUmB,IAAI,mBAM3Bc,uBAAwB,WACpBP,EAAE,eAAeQ,aAUrBC,YAAa,WACT,GAAI3C,GAAOC,IAGXb,KAAIwD,UAAU,oBAGd,IAAIC,GAAOzD,IAAI0D,cAAc7C,KAAKqB,IAAIyB,KAAK,qBAG3C,IAAIF,EAAKG,OAAS,IAEdC,YAAYC,MAAM,+BAAgC,SAC/C,CAEH,GAAIC,IAAgB,GAAItB,MAAS5B,KAAKC,sBAAwB,GAG9DD,MAAKE,sBAAwB,GAAI0B,MAGjC5B,KAAKS,UAAU0C,KAAKC,kBAAqBF,EACrBG,SAAYT,IAGhC5C,KAAKqB,IAAIyB,KAAK,sBAAsBxB,KAChCC,WAAWC,UAAU,mBAGzBxB,KAAKW,SAASwC,KAAKP,KAAQA,IAC3B5C,KAAKW,SAAS2C,KAAK,MACfxC,QAAS,SAASE,GACdjB,EAAKwD,kBAETrC,MAAO,SAASH,EAAOC,GACnBG,QAAQC,IAAIJ,EAASwC,mBAUrCD,eAAgB,WACZ,GAAIxD,GAAOC,IAGXA,MAAKqB,IAAIyB,KAAK,sBAAsBxB,KAC5B,8EAGRtB,KAAKS,UAAU0C,KAAKE,SAAYrD,KAAKW,SAASe,IAAI,QAC9C+B,kBAAqBzD,KAAKW,SAASe,IAAI,gBACvCgC,iBAAoB1D,KAAKW,SAASe,IAAI,eACtCiC,2BAA8B3D,KAAKW,SAASe,IAAI,gBAChDkC,+BAAkC5D,KAAKW,SAASe,IAAI,mBACpDmC,iBAAoB7D,KAAKW,SAASe,IAAI,iBAG1C1B,KAAK8D,WAAa7B,EAAE,qBAAqBX,OAGzCtB,KAAKqB,IAAIC,KAAKC,WAAWC,UAAU,uBAGnCS,EAAE,gBAAgBX,KAAKtB,KAAK8D,YAC5B7B,EAAE,0BAA0BX,KAAKtB,KAAK8D,YAGtC9D,KAAKqB,IAAIkB,OAAO,gDAGhBvC,KAAKqB,IAAIkB,OAAOhB,WAAWC,UAAU,eAAeC,YAChDzB,KAAKO,UAAUmB,IAAI,wBAGvBvC,IAAI4E,mBAAmB,yBAA0B/D,KAAKW,SAASe,IAAI,YAC/D3B,EAAKI,OAGI,IAAI2B,cAAa,gBAC1BC,SAAS,GAIbE,GAAE,uBAAuBW,KAAK,mBAG9B5C,KAAKqB,IAAIkB,OAAOhB,WAAWC,UAAU,mBAAmBC,YACpDzB,KAAKO,UAAUmB,IAAI,wBAEvBO,EAAE,mBAAmBQ,aAIzBuB,SAAU,WACN,GAAIjE,GAAOC,KAGPiE,GAAmB,GAAIrC,MAAS5B,KAAKE,uBAAyB,GAGlEF,MAAKqB,IAAIyB,KAAK,2BAA2BxB,KACrCC,WAAWC,UAAU,kBAGzB,IAAIoB,GAAOzD,IAAI0D,cAAc7C,KAAKqB,IAAIyB,KAAK,gBAG3C9C,MAAKS,UAAU0C,KAAKe,UAAatB,EACbuB,mBAAsBF,IAG1CjE,KAAKW,SAASwC,KAAKP,KAAQA,IAG3B5C,KAAKW,SAAS2C,KAAK,MACfxC,QAAS,SAASE,GACdjB,EAAKqE,gBAETlD,MAAO,SAASH,EAAOC,GACnBG,QAAQC,IAAIJ,EAASwC,kBAKjCY,aAAc,WAEVpE,KAAKS,UAAU0C,KAAKkB,mBAAsBrE,KAAKW,SAASe,IAAI,gBACxD4C,kBAAqBtE,KAAKW,SAASe,IAAI,eACvC6C,4BAA+BvE,KAAKW,SAASe,IAAI,gBACjD8C,gCAAmCxE,KAAKW,SAASe,IAAI,mBACrD+C,kBAAqBzE,KAAKW,SAASe,IAAI,iBAG3C1B,KAAKS,UAAU6C,KAAK,MAChBxC,QAAS,SAASE,GAEd0D,SAASC,UAEbzD,MAAO,SAASH,EAAOC,GACnBG,QAAQC,IAAI,eAO5B,GAAIjC,KAAIC","file":"text-integrated.js","sourcesContent":["var app = app || {};\n\napp.TextIntegratedView = Backbone.View.extend({\n    \n    el: '#treatment-text-integrated',\n\n    events: {\n        'click #instruction-read': 'renderEditor',\n        'click #help': 'renderInstructionModal',\n        'click #editor-button': 'analyzeText',\n        'click #editor-full-button': 'saveText',\n    },\n\n    initialize: function() {\n        // Variable declaration\n        var self = this;\n        this.prePageDurationStart = null;\n        this.postPageDurationStart = null;\n\n        // Generate 20 distinct colors for the cmap\n        this.colors = d3.scaleOrdinal(d3.schemeCategory10);\n        \n        // Get user data\n        this.userModel = new app.UserSpecificModel();\n\n        // Init textanalyzer model\n        this.textModel = new app.TextModelComplete();\n\n        // Init textAnalyzer model\n        this.analyzer = new app.TextAnalyzerModel();\n\n        // Fetch user data\n        this.userModel.fetch({\n            success: function(model, response) {\n                self.renderInstruction();\n            },\n            error: function(model, response) {\n                console.log(response);\n            }\n        });\n    },\n\n    /** Render instruction for \n      * this part of the experiment\n      */\n    renderInstruction: function() {\n        // Render instruction\n        this.$el.html(\n            Handlebars.templates.instruction({'instruction':\n                this.userModel.get('instruction')}));\n    },\n\n    /** \n     * When user has read the instruction he or she is able\n     * to write their text.\n     */\n    renderEditor: function() {\n        // Start timer for draft\n        this.prePageDurationStart = new Date();\n\n        // Render editor\n        this.$el.html(Handlebars.templates.editor());\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-textinput', {\n            toolbar: false,\n            placeholder: false,\n        });\n\n        // Add text to editor\n        $('#editor-textinput').html('<p>Schreibe hier ...</p>');\n\n        // Select text so that user can type instantly\n        var editableElement = document.\n            querySelector('#editor-textinput').firstChild;\n        editor.selectElement(editableElement);\n\n        // Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal \n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instruction') }));\n    },\n\n    /**\n     * Render modal of instruction\n     */\n    renderInstructionModal: function() {\n        $('#modal-help').openModal();\n    },\n\n    /**\n     * After user has written his or her text the \n     * user gets feedback on the draft. \n     * Before users can see the feedback we need \n     * to make some sanity checks whether the \n     * text is long enough.\n     */\n    analyzeText: function() {\n        var self = this;\n\n        // Change text with major concepts\n        app.regExText('#editor-textinput');\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-textinput'));\n\n        // Check if text is long enough\n        if (text.length < 1000) {\n            // Display toast\n            Materialize.toast('Ihr Text ist leider zu kurz.', 4000);\n        } else {\n            // Stop timer for draft\n            var draftElapsed = (new Date() - this.prePageDurationStart) / 1000;\n\n            // Start timer for text revision\n            this.postPageDurationStart = new Date();\n\n            // Set draft time and draftText to textModel\n            this.textModel.set({'pre_page_duration': draftElapsed,\n                                'pre_text': text});\n\n            // Render loading ring\n            this.$el.find('#editor-button-div').html(\n                Handlebars.templates['loading-ring']());\n\n            // Get text data\n            this.analyzer.set({'text': text});\n            this.analyzer.save(null, {\n                success: function(response) {\n                    self.renderRevision();\n                },\n                error: function(model, response) {\n                    console.log(response.responseText);\n                }\n            });\n        }\n    },\n\n    /**\n     * After user has written the draft she gets the \n     * opportunity to revise her text\n     */\n    renderRevision: function() {\n        var self = this;\n\n        // Render submit button\n        this.$el.find('#editor-button-div').html(\n                '<a class=\"waves-effect waves-light btn\" id=\"save-text\">Text abschicken</a>');\n\n        // Save data for draft\n        this.textModel.set({'pre_text': this.analyzer.get('text'),\n            'pre_num_sentences': this.analyzer.get('numSentences'),\n            'pre_num_clusters': this.analyzer.get('numClusters'),\n            'pre_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'pre_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'pre_num_concepts': this.analyzer.get('numConcepts')});\n\n        // Get inner html of text input\n        this.paragraphs = $('#editor-textinput').html();\n\n        // Change inner html\n        this.$el.html(Handlebars.templates['double-text-editor']);\n\n        // Change inner html of editor\n        $('#editor-edit').html(this.paragraphs);\n        $('#editor-visualize-text').html(this.paragraphs);\n\n        // Append help button to window\n        this.$el.append('<i id=\"help\" class=\"material-icons\">help</i>');\n\n        // Append modal \n        this.$el.append(Handlebars.templates['modal-help']({'instruction':\n            this.userModel.get('instructionreview') }));\n\n        // Highlight text\n        app.highlightWholeText('#editor-visualize-text', this.analyzer.get('clusters'),\n            self.colors);\n\n        // Enable editor functionality\n        var editor = new MediumEditor('#editor-edit', {\n            toolbar: false,\n        });\n\n        // Change text of Button\n        $('#editor-full-button').text('Text abschicken');\n\n        // Display modal\n        this.$el.append(Handlebars.templates['modal-revision']({'instruction':\n            this.userModel.get('instructionreview')}));\n        \n        $('#modal-revision').openModal();\n\n    },\n\n    saveText: function() {\n        var self = this;\n\n        // Get seconds subject worked for revision\n        var revisionElapsed = (new Date() - this.postPageDurationStart) / 1000;\n\n        // Render loading ring\n        this.$el.find('#editor-full-button-div').html(\n            Handlebars.templates['loading-ring']());\n\n        // Get text\n        var text = app.getParagraphs(this.$el.find('#editor-edit'));\n\n        // Save post text to textModel\n        this.textModel.set({'post_text': text,\n                            'post_page_duration': revisionElapsed});\n\n        // Set text to analyzer\n        this.analyzer.set({'text': text});\n\n        // Fetch data\n        this.analyzer.save(null, {\n            success: function(response) {\n                self.sendToServer();\n            },\n            error: function(model, response) {\n                console.log(response.responseText);\n            }\n        });\n    },\n\n    sendToServer: function() {\n        // Save last data \n        this.textModel.set({'post_num_sentences': this.analyzer.get('numSentences'),\n            'post_num_clusters': this.analyzer.get('numClusters'),\n            'post_num_coherent_sentences': this.analyzer.get('cohSentences'),\n            'post_num_non_coherent_sentences': this.analyzer.get('cohNotSentences'),\n            'post_num_concepts': this.analyzer.get('numConcepts')});\n        \n        // Send data to server\n        this.textModel.save(null, {\n            success: function(response) {\n                // Reload page\n                location.reload();\n            },\n            error: function(model, response) {\n                console.log('error');\n            }\n        });\n    }\n\n});\n\nnew app.TextIntegratedView();\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJ0ZXh0LWludGVncmF0ZWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFwcCB8fCB7fTtcblxuYXBwLlRleHRJbnRlZ3JhdGVkVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICBcbiAgICBlbDogJyN0cmVhdG1lbnQtdGV4dC1pbnRlZ3JhdGVkJyxcblxuICAgIGV2ZW50czoge1xuICAgICAgICAnY2xpY2sgI2luc3RydWN0aW9uLXJlYWQnOiAncmVuZGVyRWRpdG9yJyxcbiAgICAgICAgJ2NsaWNrICNoZWxwJzogJ3JlbmRlckluc3RydWN0aW9uTW9kYWwnLFxuICAgICAgICAnY2xpY2sgI2VkaXRvci1idXR0b24nOiAnYW5hbHl6ZVRleHQnLFxuICAgICAgICAnY2xpY2sgI2VkaXRvci1mdWxsLWJ1dHRvbic6ICdzYXZlVGV4dCcsXG4gICAgfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBWYXJpYWJsZSBkZWNsYXJhdGlvblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMucHJlUGFnZUR1cmF0aW9uU3RhcnQgPSBudWxsO1xuICAgICAgICB0aGlzLnBvc3RQYWdlRHVyYXRpb25TdGFydCA9IG51bGw7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgMjAgZGlzdGluY3QgY29sb3JzIGZvciB0aGUgY21hcFxuICAgICAgICB0aGlzLmNvbG9ycyA9IGQzLnNjYWxlT3JkaW5hbChkMy5zY2hlbWVDYXRlZ29yeTEwKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCB1c2VyIGRhdGFcbiAgICAgICAgdGhpcy51c2VyTW9kZWwgPSBuZXcgYXBwLlVzZXJTcGVjaWZpY01vZGVsKCk7XG5cbiAgICAgICAgLy8gSW5pdCB0ZXh0YW5hbHl6ZXIgbW9kZWxcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwgPSBuZXcgYXBwLlRleHRNb2RlbENvbXBsZXRlKCk7XG5cbiAgICAgICAgLy8gSW5pdCB0ZXh0QW5hbHl6ZXIgbW9kZWxcbiAgICAgICAgdGhpcy5hbmFseXplciA9IG5ldyBhcHAuVGV4dEFuYWx5emVyTW9kZWwoKTtcblxuICAgICAgICAvLyBGZXRjaCB1c2VyIGRhdGFcbiAgICAgICAgdGhpcy51c2VyTW9kZWwuZmV0Y2goe1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5yZW5kZXJJbnN0cnVjdGlvbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKiogUmVuZGVyIGluc3RydWN0aW9uIGZvciBcbiAgICAgICogdGhpcyBwYXJ0IG9mIHRoZSBleHBlcmltZW50XG4gICAgICAqL1xuICAgIHJlbmRlckluc3RydWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gUmVuZGVyIGluc3RydWN0aW9uXG4gICAgICAgIHRoaXMuJGVsLmh0bWwoXG4gICAgICAgICAgICBIYW5kbGViYXJzLnRlbXBsYXRlcy5pbnN0cnVjdGlvbih7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXJNb2RlbC5nZXQoJ2luc3RydWN0aW9uJyl9KSk7XG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgKiBXaGVuIHVzZXIgaGFzIHJlYWQgdGhlIGluc3RydWN0aW9uIGhlIG9yIHNoZSBpcyBhYmxlXG4gICAgICogdG8gd3JpdGUgdGhlaXIgdGV4dC5cbiAgICAgKi9cbiAgICByZW5kZXJFZGl0b3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBTdGFydCB0aW1lciBmb3IgZHJhZnRcbiAgICAgICAgdGhpcy5wcmVQYWdlRHVyYXRpb25TdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLy8gUmVuZGVyIGVkaXRvclxuICAgICAgICB0aGlzLiRlbC5odG1sKEhhbmRsZWJhcnMudGVtcGxhdGVzLmVkaXRvcigpKTtcblxuICAgICAgICAvLyBFbmFibGUgZWRpdG9yIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgdmFyIGVkaXRvciA9IG5ldyBNZWRpdW1FZGl0b3IoJyNlZGl0b3ItdGV4dGlucHV0Jywge1xuICAgICAgICAgICAgdG9vbGJhcjogZmFsc2UsXG4gICAgICAgICAgICBwbGFjZWhvbGRlcjogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCB0ZXh0IHRvIGVkaXRvclxuICAgICAgICAkKCcjZWRpdG9yLXRleHRpbnB1dCcpLmh0bWwoJzxwPlNjaHJlaWJlIGhpZXIgLi4uPC9wPicpO1xuXG4gICAgICAgIC8vIFNlbGVjdCB0ZXh0IHNvIHRoYXQgdXNlciBjYW4gdHlwZSBpbnN0YW50bHlcbiAgICAgICAgdmFyIGVkaXRhYmxlRWxlbWVudCA9IGRvY3VtZW50LlxuICAgICAgICAgICAgcXVlcnlTZWxlY3RvcignI2VkaXRvci10ZXh0aW5wdXQnKS5maXJzdENoaWxkO1xuICAgICAgICBlZGl0b3Iuc2VsZWN0RWxlbWVudChlZGl0YWJsZUVsZW1lbnQpO1xuXG4gICAgICAgIC8vIEFwcGVuZCBoZWxwIGJ1dHRvbiB0byB3aW5kb3dcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKCc8aSBpZD1cImhlbHBcIiBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+aGVscDwvaT4nKTtcblxuICAgICAgICAvLyBBcHBlbmQgbW9kYWwgXG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZChIYW5kbGViYXJzLnRlbXBsYXRlc1snbW9kYWwtaGVscCddKHsnaW5zdHJ1Y3Rpb24nOlxuICAgICAgICAgICAgdGhpcy51c2VyTW9kZWwuZ2V0KCdpbnN0cnVjdGlvbicpIH0pKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIG1vZGFsIG9mIGluc3RydWN0aW9uXG4gICAgICovXG4gICAgcmVuZGVySW5zdHJ1Y3Rpb25Nb2RhbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJyNtb2RhbC1oZWxwJykub3Blbk1vZGFsKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFmdGVyIHVzZXIgaGFzIHdyaXR0ZW4gaGlzIG9yIGhlciB0ZXh0IHRoZSBcbiAgICAgKiB1c2VyIGdldHMgZmVlZGJhY2sgb24gdGhlIGRyYWZ0LiBcbiAgICAgKiBCZWZvcmUgdXNlcnMgY2FuIHNlZSB0aGUgZmVlZGJhY2sgd2UgbmVlZCBcbiAgICAgKiB0byBtYWtlIHNvbWUgc2FuaXR5IGNoZWNrcyB3aGV0aGVyIHRoZSBcbiAgICAgKiB0ZXh0IGlzIGxvbmcgZW5vdWdoLlxuICAgICAqL1xuICAgIGFuYWx5emVUZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vIENoYW5nZSB0ZXh0IHdpdGggbWFqb3IgY29uY2VwdHNcbiAgICAgICAgYXBwLnJlZ0V4VGV4dCgnI2VkaXRvci10ZXh0aW5wdXQnKTtcblxuICAgICAgICAvLyBHZXQgdGV4dFxuICAgICAgICB2YXIgdGV4dCA9IGFwcC5nZXRQYXJhZ3JhcGhzKHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItdGV4dGlucHV0JykpO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRleHQgaXMgbG9uZyBlbm91Z2hcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoIDwgMTAwMCkge1xuICAgICAgICAgICAgLy8gRGlzcGxheSB0b2FzdFxuICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0lociBUZXh0IGlzdCBsZWlkZXIgenUga3Vyei4nLCA0MDAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFN0b3AgdGltZXIgZm9yIGRyYWZ0XG4gICAgICAgICAgICB2YXIgZHJhZnRFbGFwc2VkID0gKG5ldyBEYXRlKCkgLSB0aGlzLnByZVBhZ2VEdXJhdGlvblN0YXJ0KSAvIDEwMDA7XG5cbiAgICAgICAgICAgIC8vIFN0YXJ0IHRpbWVyIGZvciB0ZXh0IHJldmlzaW9uXG4gICAgICAgICAgICB0aGlzLnBvc3RQYWdlRHVyYXRpb25TdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIC8vIFNldCBkcmFmdCB0aW1lIGFuZCBkcmFmdFRleHQgdG8gdGV4dE1vZGVsXG4gICAgICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwcmVfcGFnZV9kdXJhdGlvbic6IGRyYWZ0RWxhcHNlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ByZV90ZXh0JzogdGV4dH0pO1xuXG4gICAgICAgICAgICAvLyBSZW5kZXIgbG9hZGluZyByaW5nXG4gICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcjZWRpdG9yLWJ1dHRvbi1kaXYnKS5odG1sKFxuICAgICAgICAgICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzWydsb2FkaW5nLXJpbmcnXSgpKTtcblxuICAgICAgICAgICAgLy8gR2V0IHRleHQgZGF0YVxuICAgICAgICAgICAgdGhpcy5hbmFseXplci5zZXQoeyd0ZXh0JzogdGV4dH0pO1xuICAgICAgICAgICAgdGhpcy5hbmFseXplci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlclJldmlzaW9uKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWZ0ZXIgdXNlciBoYXMgd3JpdHRlbiB0aGUgZHJhZnQgc2hlIGdldHMgdGhlIFxuICAgICAqIG9wcG9ydHVuaXR5IHRvIHJldmlzZSBoZXIgdGV4dFxuICAgICAqL1xuICAgIHJlbmRlclJldmlzaW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vIFJlbmRlciBzdWJtaXQgYnV0dG9uXG4gICAgICAgIHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItYnV0dG9uLWRpdicpLmh0bWwoXG4gICAgICAgICAgICAgICAgJzxhIGNsYXNzPVwid2F2ZXMtZWZmZWN0IHdhdmVzLWxpZ2h0IGJ0blwiIGlkPVwic2F2ZS10ZXh0XCI+VGV4dCBhYnNjaGlja2VuPC9hPicpO1xuXG4gICAgICAgIC8vIFNhdmUgZGF0YSBmb3IgZHJhZnRcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2V0KHsncHJlX3RleHQnOiB0aGlzLmFuYWx5emVyLmdldCgndGV4dCcpLFxuICAgICAgICAgICAgJ3ByZV9udW1fc2VudGVuY2VzJzogdGhpcy5hbmFseXplci5nZXQoJ251bVNlbnRlbmNlcycpLFxuICAgICAgICAgICAgJ3ByZV9udW1fY2x1c3RlcnMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ2x1c3RlcnMnKSxcbiAgICAgICAgICAgICdwcmVfbnVtX2NvaGVyZW50X3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdjb2hTZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwcmVfbnVtX25vbl9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oTm90U2VudGVuY2VzJyksXG4gICAgICAgICAgICAncHJlX251bV9jb25jZXB0cyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1Db25jZXB0cycpfSk7XG5cbiAgICAgICAgLy8gR2V0IGlubmVyIGh0bWwgb2YgdGV4dCBpbnB1dFxuICAgICAgICB0aGlzLnBhcmFncmFwaHMgPSAkKCcjZWRpdG9yLXRleHRpbnB1dCcpLmh0bWwoKTtcblxuICAgICAgICAvLyBDaGFuZ2UgaW5uZXIgaHRtbFxuICAgICAgICB0aGlzLiRlbC5odG1sKEhhbmRsZWJhcnMudGVtcGxhdGVzWydkb3VibGUtdGV4dC1lZGl0b3InXSk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIGlubmVyIGh0bWwgb2YgZWRpdG9yXG4gICAgICAgICQoJyNlZGl0b3ItZWRpdCcpLmh0bWwodGhpcy5wYXJhZ3JhcGhzKTtcbiAgICAgICAgJCgnI2VkaXRvci12aXN1YWxpemUtdGV4dCcpLmh0bWwodGhpcy5wYXJhZ3JhcGhzKTtcblxuICAgICAgICAvLyBBcHBlbmQgaGVscCBidXR0b24gdG8gd2luZG93XG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZCgnPGkgaWQ9XCJoZWxwXCIgY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPmhlbHA8L2k+Jyk7XG5cbiAgICAgICAgLy8gQXBwZW5kIG1vZGFsIFxuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoSGFuZGxlYmFycy50ZW1wbGF0ZXNbJ21vZGFsLWhlbHAnXSh7J2luc3RydWN0aW9uJzpcbiAgICAgICAgICAgIHRoaXMudXNlck1vZGVsLmdldCgnaW5zdHJ1Y3Rpb25yZXZpZXcnKSB9KSk7XG5cbiAgICAgICAgLy8gSGlnaGxpZ2h0IHRleHRcbiAgICAgICAgYXBwLmhpZ2hsaWdodFdob2xlVGV4dCgnI2VkaXRvci12aXN1YWxpemUtdGV4dCcsIHRoaXMuYW5hbHl6ZXIuZ2V0KCdjbHVzdGVycycpLFxuICAgICAgICAgICAgc2VsZi5jb2xvcnMpO1xuXG4gICAgICAgIC8vIEVuYWJsZSBlZGl0b3IgZnVuY3Rpb25hbGl0eVxuICAgICAgICB2YXIgZWRpdG9yID0gbmV3IE1lZGl1bUVkaXRvcignI2VkaXRvci1lZGl0Jywge1xuICAgICAgICAgICAgdG9vbGJhcjogZmFsc2UsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoYW5nZSB0ZXh0IG9mIEJ1dHRvblxuICAgICAgICAkKCcjZWRpdG9yLWZ1bGwtYnV0dG9uJykudGV4dCgnVGV4dCBhYnNjaGlja2VuJyk7XG5cbiAgICAgICAgLy8gRGlzcGxheSBtb2RhbFxuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoSGFuZGxlYmFycy50ZW1wbGF0ZXNbJ21vZGFsLXJldmlzaW9uJ10oeydpbnN0cnVjdGlvbic6XG4gICAgICAgICAgICB0aGlzLnVzZXJNb2RlbC5nZXQoJ2luc3RydWN0aW9ucmV2aWV3Jyl9KSk7XG4gICAgICAgIFxuICAgICAgICAkKCcjbW9kYWwtcmV2aXNpb24nKS5vcGVuTW9kYWwoKTtcblxuICAgIH0sXG5cbiAgICBzYXZlVGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvLyBHZXQgc2Vjb25kcyBzdWJqZWN0IHdvcmtlZCBmb3IgcmV2aXNpb25cbiAgICAgICAgdmFyIHJldmlzaW9uRWxhcHNlZCA9IChuZXcgRGF0ZSgpIC0gdGhpcy5wb3N0UGFnZUR1cmF0aW9uU3RhcnQpIC8gMTAwMDtcblxuICAgICAgICAvLyBSZW5kZXIgbG9hZGluZyByaW5nXG4gICAgICAgIHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItZnVsbC1idXR0b24tZGl2JykuaHRtbChcbiAgICAgICAgICAgIEhhbmRsZWJhcnMudGVtcGxhdGVzWydsb2FkaW5nLXJpbmcnXSgpKTtcblxuICAgICAgICAvLyBHZXQgdGV4dFxuICAgICAgICB2YXIgdGV4dCA9IGFwcC5nZXRQYXJhZ3JhcGhzKHRoaXMuJGVsLmZpbmQoJyNlZGl0b3ItZWRpdCcpKTtcblxuICAgICAgICAvLyBTYXZlIHBvc3QgdGV4dCB0byB0ZXh0TW9kZWxcbiAgICAgICAgdGhpcy50ZXh0TW9kZWwuc2V0KHsncG9zdF90ZXh0JzogdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zdF9wYWdlX2R1cmF0aW9uJzogcmV2aXNpb25FbGFwc2VkfSk7XG5cbiAgICAgICAgLy8gU2V0IHRleHQgdG8gYW5hbHl6ZXJcbiAgICAgICAgdGhpcy5hbmFseXplci5zZXQoeyd0ZXh0JzogdGV4dH0pO1xuXG4gICAgICAgIC8vIEZldGNoIGRhdGFcbiAgICAgICAgdGhpcy5hbmFseXplci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kVG9TZXJ2ZXIoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24obW9kZWwsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNlbmRUb1NlcnZlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFNhdmUgbGFzdCBkYXRhIFxuICAgICAgICB0aGlzLnRleHRNb2RlbC5zZXQoeydwb3N0X251bV9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fY2x1c3RlcnMnOiB0aGlzLmFuYWx5emVyLmdldCgnbnVtQ2x1c3RlcnMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb2hlcmVudF9zZW50ZW5jZXMnOiB0aGlzLmFuYWx5emVyLmdldCgnY29oU2VudGVuY2VzJyksXG4gICAgICAgICAgICAncG9zdF9udW1fbm9uX2NvaGVyZW50X3NlbnRlbmNlcyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdjb2hOb3RTZW50ZW5jZXMnKSxcbiAgICAgICAgICAgICdwb3N0X251bV9jb25jZXB0cyc6IHRoaXMuYW5hbHl6ZXIuZ2V0KCdudW1Db25jZXB0cycpfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBTZW5kIGRhdGEgdG8gc2VydmVyXG4gICAgICAgIHRoaXMudGV4dE1vZGVsLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihtb2RlbCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG59KTtcblxubmV3IGFwcC5UZXh0SW50ZWdyYXRlZFZpZXcoKTtcbiJdLCJmaWxlIjoidGV4dC1pbnRlZ3JhdGVkLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=\n"],"sourceRoot":"/source/"}